<!doctype html><html xmlns:wb=http://open.weibo.com/wb lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Electron failed to install correctly"><meta name=generator content="Hugo 0.123.3"><title>Electron安装失败 &#183; 戈壁堂</title>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css><!--[if lte IE 8]><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css><!--<![endif]--><!--[if lte IE 8]><link rel=stylesheet href=http://gebitang.com/css/side-menu-old-ie.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=http://gebitang.com/css/side-menu.css><!--<![endif]--><link rel=stylesheet href=http://gebitang.com/css/blackburn.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.9.0/css/all.css><link href="https://fonts.googleapis.com/css?family=Raleway" rel=stylesheet type=text/css><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js></script><script>hljs.initHighlightingOnLoad()</script><link rel="shortcut icon" href=http://gebitang.com/img/favicon.ico type=image/x-icon><link rel=stylesheet href=http://gebitang.com/css/my.css><script src=http://gebitang.com/js/my.js></script></head><body><div id=layout><a href=#menu id=menuLink class=menu-link><span></span></a><div id=menu><a class="pure-menu-heading brand" href=http://gebitang.com/>Gebitang</a><div class=pure-menu><ul class=pure-menu-list><li class=pure-menu-item><a class=pure-menu-link href=http://gebitang.com/><i class='fa fa-home fa-fw'></i>Home</a></li><li class=pure-menu-item><a class=pure-menu-link href=http://gebitang.com/post/><i class='fa fa-list fa-fw'></i>Posts</a></li><li class=pure-menu-item><a class=pure-menu-link href=http://gebitang.com/about/><i class='fa fa-user fa-fw'></i>About</a></li><li class=pure-menu-item><a class=pure-menu-link href=http://gebitang.com/contact/><i class='fa fa-phone fa-fw'></i>Contact</a></li><li class=pure-menu-item><a class=pure-menu-link href=http://gebitang.com/tags/><i class='fa fa-tags fa-fw'></i>Tags</a></li><li class=pure-menu-item><a class=pure-menu-link href=http://gebitang.com/topics/><i class='fa fa-folder fa-fw'></i>Topics</a></li></ul></div><div class="pure-menu social"><ul class=pure-menu-list></ul></div><div><div class=small-print><small><a rel=license href=http://creativecommons.org/licenses/by/4.0/><img alt=知识共享许可协议 style=border-width:0 src=https://i.creativecommons.org/l/by/4.0/80x15.png></a><br>本<span xmlns:dct=http://purl.org/dc/terms/ href=http://purl.org/dc/dcmitype/Text rel=dct:type>作品</span>由<a xmlns:cc=http://creativecommons.org/ns# href=http://gebitang.com property="cc:attributionName" rel=cc:attributionURL>&nbsp;Gebitang&nbsp;&nbsp;</a>采用<a rel=license href=http://creativecommons.org/licenses/by/4.0/>知识共享署名 4.0 国际许可协议</a>进行许可&nbsp;&copy; 2018</small></div><div class=small-print><small></small></div><div class=small-print><small>Built with&nbsp;<a href=https://gohugo.io/ target=_blank>Hugo</a></small>
<small>Theme&nbsp;<a href=https://github.com/yoshiharuyamashita/blackburn target=_blank>Blackburn</a></small></div><div style=display:none><div class=small-print><small><wb:follow-button uid=2446212465 type=red_1 width=67 height=24></wb:follow-button></small></div></div></div></div><div id=main><div class=header><h1>Electron安装失败</h1><h2>Electron failed to install correctly</h2></div><div class=content><div class=post-meta><div><i class="fa fa-calendar fa-fw"></i>
<time>2020-03-17</time></div><div><i class="fa fa-folder fa-fw"></i>
<a class=post-taxonomy-topic href=http://gebitang.com/topics/jiansh>jiansh</a>&nbsp;/
<a class=post-taxonomy-topic href=http://gebitang.com/topics/front-end>Front-End</a></div><div><i class="fa fa-tags fa-fw"></i>
<a class=post-taxonomy-tag href=http://gebitang.com/tags/jiansh>jiansh</a></div></div><nav id=TableOfContents><ul><li><ul><li><a href=#840版本-mac>8.4.0版本 Mac</a></li><li><a href=#830版本>8.3.0版本</a></li><li><a href=#825版本>8.2.5版本</a></li></ul></li></ul></nav><h3 id=840版本-mac>8.4.0版本 Mac</h3><p>删除Cache还是升级了Mixin。 0.10.2版本Mac上需要electron的8.4版本 <code>cat yarn.lock | grep electron</code></p><p>Mac上出现跟Windows上类似的情况。需要手动下载<code>https://github.com/electron/electron/releases/tag/v8.4.0</code>的<code>electron-v8.4.0-darwin-x64.zip</code>，然后解压到项目的 <code>node_modules/electron/disk</code>目录下。</p><p>手动创建<code>path.txt</code>文件，内容添加未 <code>Electron.app/Contents/MacOS/Electron</code>，第一开始只写了<code>Electron.app</code>是无效的。后面安装了一个全局的Electron参考了对应的<code>path.txt</code>里的写法。</p><p>但依然报错——</p><pre tabindex=0><code>INFO  Launching Electron...
(node:55762) UnhandledPromiseRejectionWarning: Error: spawn /Users/gebitang/projects/github/desktop-app/node_modules/electron/dist/Electron.app/Contents/MacOS/Electron
 ENOENT
    at Process.ChildProcess._handle.onexit (internal/child_process.js:264:19)
    at onErrorNT (internal/child_process.js:456:16)
    at processTicksAndRejections (internal/process/task_queues.js:80:21)
(node:55762) UnhandledPromiseRejectionWarning: Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). (rejection id: 2)
(node:55762) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code.
</code></pre><p><a href=https://stackoverflow.com/a/45152755/1087122>有说是$PATH问题</a> 添加了PATH路径后，问题依旧；</p><p><a href=https://github.com/electron/electron-rebuild/issues/39>官方#39</a>针对的是windows环境下的问题。</p><p>直接启动安装的Electron，验证是否正确安装。应用正常启动，到包含了类似的报错——</p><pre tabindex=0><code>Reading /Users/gebitang/projects/project-desktop/uitest-desktop/node_modules/devtron/manifest.json failed.
Error: ENOENT: no such file or directory, open &#39;/Users/gebitang/projects/project-desktop/uitest-desktop/node_modules/devtron/manifest.json&#39;
    at Object.openSync (fs.js:440:3)
    at Object.func [as openSync] (electron/js2c/asar.js:140:31)
    at Object.readFileSync (fs.js:342:35)
    at Object.fs.readFileSync (electron/js2c/asar.js:542:40)
    at getManifestFromPath (electron/js2c/browser_init.js:4124:26)
    at Function.BrowserWindow.addExtension (electron/js2c/browser_init.js:4546:22)
    at Function.BrowserWindow.addDevToolsExtension (electron/js2c/browser_init.js:4578:40)
    at App.&lt;anonymous&gt; (electron/js2c/browser_init.js:4607:23)
    at Object.onceWrapper (events.js:300:26)
    at App.emit (events.js:215:7)
</code></pre><p><a href=https://stackoverflow.com/a/54819116/1087122>有类似的问题</a>，删除<code>~/Library/Application Support/Electron/DevTools Extensions</code>文件之后，上述问题消失。但使用 <code>yarn electron:serve</code>时依然复现相同的问题。</p><p>按照<code>index.js</code>的要求，导出<code>ELECTRON_OVERRIDE_DIST_PATH</code> 的值(<a href=https://www.electronjs.org/docs/api/environment-variables>官方教程：变量使用</a>)，还是不行。</p><p>先卸载，再手动使用npm安装<code>npm install electron@^v8.4.0</code>。实际上安装的为<code>8.4.1</code>版本，内网和淘宝的registry都没有速度，挂上代理，使用<code>npm --registry https://registry.npm.taobao.org install </code>安装成功。</p><p>应用可以成功启动，但提示编译的版本不对。重新执行 <code>yarn install</code>之后，再启动应用。成功。</p><p>还是没看出来哪里导致的问题。难不成是8.4.0版本有bug乜:(</p><h3 id=830版本>8.3.0版本</h3><p>哈哈，我这个应该叫做跟着Mixin学Node乜。今天升级到0.9.6版本后启动遇到点小问题。<code>node-gyp</code>和<code>electron</code>安装问题</p><ul><li>yarn执行安装失败。<code>node-gyp</code>的安装应该需要翻墙。使用代理后的CMD窗口后编译正常。</li></ul><p>用来进行交叉编译的？可以进行全局安装一下？之前搭建STF环境时也遇到过这个问题。</p><blockquote><p><a href=https://github.com/nodejs/node-gyp><code>node-gyp</code></a> is a cross-platform command-line tool written in Node.js for compiling native addon modules for Node.js. It contains a fork of the <a href=https://gyp.gsrc.io/>gyp</a> project that was previously used by the Chromium team, extended to support the development of Node.js native addons.</p><p>Note that <code>node-gyp</code> is not used to build Node.js itself.</p></blockquote><pre tabindex=0><code> &gt; node-gyp rebuild --release                                                                                                                                                
                                                                                                                                                                             
                                                                                                                                                                             
 D:\openSources\mixin\desktop-app\node_modules\better-sqlite3&gt;if not defined npm_config_node_gyp (node &#34;D:\tools\nvmm\v12.11.1\node_modules\npm\node_modules\npm-lifecycle\no
yp-bin\\..\..\node_modules\node-gyp\bin\node-gyp.js&#34; rebuild --release )  else (node &#34;D:\tools\nvmm\v12.11.1\node_modules\npm\node_modules\node-gyp\bin\node-gyp.js&#34; rebuild 
lease )                                                                                                                                                                      
 info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.                                                                                        
                                                                                                                                                                             
                 errorOut=prebuild-install WARN install No prebuilt binaries found (target=8.3.0 runtime=electron arch=x64 libc= platform=win32)                             
 gyp WARN install got an error, rolling back install                                                                                                                         
 gyp ERR! configure error                                                                                                                                                    
 gyp ERR! stack Error: read ECONNRESET                                                                                                                                       
 gyp ERR! stack     at TLSWrap.onStreamRead (internal/stream_base_commons.js:201:27)                                                                                         
 gyp ERR! System Windows_NT 10.0.18363                                                                                                                                       
 gyp ERR! command &#34;C:\\Program Files\\nodejs\\node.exe&#34; &#34;D:\\tools\\nvmm\\v12.11.1\\node_modules\\npm\\node_modules\\node-gyp\\bin\\node-gyp.js&#34; &#34;rebuild&#34; &#34;--release&#34;       
 gyp ERR! cwd D:\openSources\mixin\desktop-app\node_modules\better-sqlite3                                                                                                   
 gyp ERR! node -v v12.11.1                                                                                                                                                   
 gyp ERR! node-gyp -v v5.0.3                                                                                                                                                 
 gyp ERR! not ok                                                                                                                                                             
 npm ERR! code ELIFECYCLE                                                                                                                                                    
 npm ERR! errno 1                                                                                                                                                            
 npm ERR! better-sqlite3@7.0.1 build-release: `node-gyp rebuild --release`                                                                                                   
 npm ERR! Exit status 1                                                                                                                                                      
 npm ERR!                                                                                                                                                                    
 npm ERR! Failed at the better-sqlite3@7.0.1 build-release script.                                                                                                           
 npm ERR! This is probably not a problem with npm. There is likely additional logging output above.                                                                          
                                                                                                                                                                             
</code></pre><ul><li>启动再次遇到Electron问题</li></ul><p>应该是yarn重新编译时将我之前手动安装的8.2.5版本清理了。最新版本根据<code>yarn.lock</code>文件看升级到了<code>8.3.0</code>版本。对应的判断逻辑也做了优化。</p><p>轻车熟路，手动下载<code>8.3.0</code>版本，解压到electron模块的<code>dist</code>文件夹，新建<code>path.txt</code>文件，内容写入<code>electron.exe</code>。启动成功。</p><p>Node看起来会默认自动检查dist目录。第一次写入<code>dist\electron.exe</code>的内容，启动报错<code>UnhandledPromiseRejectionWarning spawn D:\openSources\mixin\desktop-app\node_modules\electron\dist\dist\electron.exe</code></p><pre tabindex=0><code>D:\openSources\mixin\desktop-app\node_modules\electron\index.js:14
    throw new Error(&#39;Electron failed to install correctly, please delete node_modules/electron and try installing again&#39;)
    ^
...
</code></pre><hr><h3 id=825版本>8.2.5版本</h3><p>Electron failed to install correctly, please delete node_modules/electron and try installing again</p><p>安装了多次，总是提示上面的错误。在Mac环境下是正常的。因为懒惰&恐惧的原因，一直没有<strong>正面强攻</strong>解决问题。尝试重新安装，清除仓库从头安装，都无疾而终。</p><p><a href=https://github.com/electron/electron/issues/20994>这里有针对window环境的解决</a></p><ul><li>Create a file named path.txt in node_modules\electron folder.</li><li>Write electron.exe in it.</li><li>Download electron package manualy.</li><li>Unpackage the electron files into node_modules\electron\dist</li><li>Run your start script</li></ul><p>看看源码+对比Mac环境下的内容：</p><p>首先是缺少<code>path.txt</code>文件。这样至少可以试试上面的解决方案。</p><pre tabindex=0><code>    throw new Error(&#39;Electron failed to install correctly, please delete node_modules/electron and try installing again&#39;)
    ^

Error: Electron failed to install correctly, please delete node_modules/electron and try installing again
    at getElectronPath (D:\openSources\mixin\desktop-app\node_modules\electron\index.js:14:11)
    at Object.&lt;anonymous&gt; (D:\openSources\mixin\desktop-app\node_modules\electron\index.js:18:18)
    at Module._compile (internal/modules/cjs/loader.js:945:30)
    at Object.Module._extensions..js (internal/modules/cjs/loader.js:962:10)
    at Module.load (internal/modules/cjs/loader.js:798:32)
    at Function.Module._load (internal/modules/cjs/loader.js:711:12)
    at Module.require (internal/modules/cjs/loader.js:838:19)
    at require (internal/modules/cjs/helpers.js:74:18)
    at Object.&lt;anonymous&gt; (D:\openSources\mixin\desktop-app\node_modules\vue-cli-plugin-electron-builder\lib\testWithSpectron.js:2:22)
    at Module._compile (internal/modules/cjs/loader.js:945:30)
error Command failed with exit code 1.
</code></pre><p><code>npm --registry https://registry.npm.taobao.org install electron</code>手动安装electron时依然报错——</p><pre tabindex=0><code>&gt; node install.js

Downloading electron-v7.1.14-win32-x64.zip: [====================================================================================================] 100% ETA: 0.0 seconds
(node:13260) UnhandledPromiseRejectionWarning: RequestError: read ECONNRESET
    at ClientRequest.&lt;anonymous&gt; (D:\openSources\mixin\desktop-app\node_modules\got\source\request-as-event-emitter.js:178:14)
    at Object.onceWrapper (events.js:300:26)
    at ClientRequest.emit (events.js:215:7)
    at ClientRequest.origin.emit (D:\openSources\mixin\desktop-app\node_modules\@szmarczak\http-timer\source\index.js:37:11)
    at TLSSocket.socketErrorListener (_http_client.js:406:9)
    at TLSSocket.emit (events.js:210:5)
    at emitErrorNT (internal/streams/destroy.js:91:8)
    at emitErrorAndCloseNT (internal/streams/destroy.js:59:3)
    at processTicksAndRejections (internal/process/task_queues.js:80:21)
(node:13260) UnhandledPromiseRejectionWarning: Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). (rejection id: 1)
(node:13260) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code.
</code></pre><p>这样就正式到<a href=https://github.com/electron/electron/releases/>github electron release</a>下载对应的版本<a href=https://github.com/electron/electron/releases/download/v7.1.14/electron-v7.1.14-win32-x64.zip><code>electron-v7.1.14-win32-x64.zip</code></a></p><p>可以完成electorn的安装。从github的官方issue里也可以看到这种情况是因为在安装过程中出现hang现象（手动强制暂停后，又重新进行安装）</p><blockquote><p>The error message actually occurs when you cancel the hanging install and nevertheless try to run the project.</p></blockquote><p>靠谱，没报错，但也没启动起来应用:(</p><pre tabindex=0><code>Failed to fetch extension, trying 4 more times
Failed to fetch extension, trying 3 more times
Failed to fetch extension, trying 2 more times
Failed to fetch extension, trying 1 more times
Failed to fetch extension, trying 0 more times
Vue Devtools failed to install: Error: net::ERR_CONNECTION_RESET
</code></pre><hr><p><a href=https://github.com/electron/electron/issues/20731>electron 官方 #20731</a></p><p>根据yarn.lock中定义的<code>electron@^v8.2.5</code>从<a href=https://github.com/electron/electron/releases/tag/v8.2.5>这里</a>进行<a href=https://github.com/electron/electron/releases/download/v8.2.5/electron-v8.2.5-win32-x64.zip>下载</a>(vpn需要使用直连模式，转发模式无法下载)后，解压到 <code>node_modules\electron</code>目录下，并且手动增加<code>path.txt</code>文件。写入绝对路径。</p><p>electron可以正常启动。项目也正常编译，但运行失败了——</p><pre tabindex=0><code>-  Bundling main process...
No type errors found
Version: typescript 3.7.5
Time: 6574ms
 DONE  Compiled successfully in 2077ms17:46:29

  File                      Size                     Gzipped

  dist_electron\index.js    1424.07 KiB              277.96 KiB

  Images and other types of assets omitted.

 INFO  Launching Electron...
�ļ�����Ŀ¼��������﷨����ȷ��
(node:30396) UnhandledPromiseRejectionWarning: Error: spawn D:\openSources\mixin\desktop-app\node_modules\electron\dist\D:\openSources\mixin\desktop-app\node_modules\electron\electron.exe ENOENT
    at notFoundError (D:\openSources\mixin\desktop-app\node_modules\vue-cli-plugin-electron-builder\node_modules\cross-spawn\lib\enoent.js:6:26)
    at verifyENOENT (D:\openSources\mixin\desktop-app\node_modules\vue-cli-plugin-electron-builder\node_modules\cross-spawn\lib\enoent.js:40:16)
    at ChildProcess.cp.emit (D:\openSources\mixin\desktop-app\node_modules\vue-cli-plugin-electron-builder\node_modules\cross-spawn\lib\enoent.js:27:25)
    at Process.ChildProcess._handle.onexit (internal/child_process.js:272:12)
(node:30396) UnhandledPromiseRejectionWarning: Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). (rejection id: 1)
(node:30396) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code.
</code></pre><p>看起来是在对应的目录没找到electron.exe，再手动帮助它一波：新建dist目录，将下载的zip文件解压到dist目录下。</p><p>启动成功:)</p><pre tabindex=0><code>  App running at:
  - Local:   http://localhost:8080/
  - Network: http://192.168.1.106:8080/

  Note that the development build is not optimized.
  To create a production build, run yarn build.

\  Bundling main process...

 DONE  Compiled successfully in 2116ms                                                                                                                                   18:16:43

  File                      Size                     Gzipped

  dist_electron\index.js    1424.07 KiB              277.96 KiB

  Images and other types of assets omitted.

 INFO  Launching Electron...
(electron) The default value of app.allowRendererProcessReuse is deprecated, it is currently &#34;false&#34;.  It will change to be &#34;true&#34; in Electron 9.  For more information please check https://github.com/electron/electron/issues/18397
</code></pre><div class="prev-next-post pure-g"><div class=pure-u-1-24 style=text-align:left><a href=http://gebitang.com/post/2020/0313-be-a-good-man/><i class="fa fa-chevron-left"></i></a></div><div class=pure-u-10-24><nav class=prev><a href=http://gebitang.com/post/2020/0313-be-a-good-man/>做好人难，一定要做好人</a></nav></div><div class=pure-u-2-24>&nbsp;</div><div class=pure-u-10-24><nav class=next><a href=http://gebitang.com/post/2020/0319-sonar-go-with-coverage/>Sonar实践问题：支持go工程的覆盖率</a></nav></div><div class=pure-u-1-24 style=text-align:right><a href=http://gebitang.com/post/2020/0319-sonar-go-with-coverage/><i class="fa fa-chevron-right"></i></a></div></div><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="gebitang",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=http://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div><script src=http://gebitang.com/js/ui.js></script><script src=http://gebitang.com/js/menus.js></script><script>window.location.hostname!="localhost"&&(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-34303694-1","auto"),ga("send","pageview"))</script><button onclick=topFunction() id=myBtn title="Go to top">Top</button></body></html>