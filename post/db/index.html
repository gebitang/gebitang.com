<!DOCTYPE html>
<html xmlns:wb="http://open.weibo.com/wb" lang="en" >

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="about database">
  <meta name="generator" content="Hugo 0.74.3" />

  <title>db &middot; 戈壁堂</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="http://gebitang.com/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="http://gebitang.com/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="http://gebitang.com/css/blackburn.css">

  
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.9.0/css/all.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="http://gebitang.com/img/favicon.ico" type="image/x-icon" />

  
    
        <link rel="stylesheet" href="http://gebitang.com/css/my.css">
    
  
  
    
        <script src="http://gebitang.com/js/my.js"></script>
    
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="http://gebitang.com/">Gebitang</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://gebitang.com/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://gebitang.com/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://gebitang.com/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://gebitang.com/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://gebitang.com/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="http://gebitang.com/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>

  <div class="small-print">
  	<small>
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" /></a><br/>本<span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" rel="dct:type">作品</span>由<a xmlns:cc="http://creativecommons.org/ns#" href="http://gebitang.com" property="cc:attributionName" rel="cc:attributionURL">&nbsp;Gebitang&nbsp;&nbsp;</a>采用<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">知识共享署名 4.0 国际许可协议</a>进行许可&nbsp;&copy; 2018
    </small>

  </div>

  <div class="small-print">
    <small></small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>

  <div style="display:none">
  <div class="small-print">
    <small>
    <wb:follow-button uid="2446212465" type="red_1" width="67" height="24"></wb:follow-button>
  </small>
  </div>
  </div>

</div>

</div>


  <div id="main">


<div class="header">
  <h1>db</h1>
  <h2>about database</h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2021-07-21</time>
  </div>

  

  
  
  
  <div>
    <i class="fa fa-folder fa-fw"></i>
    
      <a class="post-taxonomy-topic" href="http://gebitang.com/topics/sql">sql</a>
    
  </div>
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="http://gebitang.com/tags/sql">sql</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="http://gebitang.com/tags/db">db</a>
    
  </div>
  
  

</div>

  
	<nav id="TableOfContents">
  <ul>
    <li><a href="#lealone">lealone</a>
      <ul>
        <li><a href="#创建ide-debug环境">创建IDE Debug环境</a></li>
      </ul>
    </li>
    <li><a href="#how-does-a-relational-database-work">How does a relational database work</a></li>
    <li><a href="#olap-vs-oltp">OLAP VS. OLTP</a>
      <ul>
        <li><a href="#olap">OLAP</a></li>
        <li><a href="#oltp">OLTP</a></li>
      </ul>
    </li>
    <li><a href="#database-vs-schema">Database VS. Schema</a></li>
    <li><a href="#lealone-basic">Lealone basic</a></li>
    <li><a href="#presto">Presto</a>
      <ul>
        <li><a href="#data-function">data function</a></li>
      </ul>
    </li>
  </ul>
</nav>
  

  <p>SQL: Structured Query Language<br>
NoSQL: not only SQL (键值、文档、列存储、图)<br>
NewSQL: combine SQL and NoSQL ??</p>
<p><a href="https://www.xenonstack.com/blog/sql-vs-nosql-vs-newsql">SQL vs NoSQL vs NewSQL</a></p>
<p><strong>ACID</strong>  Atomicity, Consistency, Isolation, Durability to maintain the reliability of transactions.</p>
<blockquote>
<p><strong>Atomicity</strong> – completion of the transaction as a whole or none at all<br>
<strong>Consistency</strong> – assures the stable state of the database with or without changes<br>
<strong>Isolation</strong> – multiple transactions do not interfere with each other<br>
<strong>Durability</strong> – permanent effect on the database by the changes</p>
</blockquote>
<p><a href="https://www.guru99.com/oltp-vs-olap.html">oltp vs. olap</a></p>
<h2 id="lealone">lealone</h2>
<h3 id="创建ide-debug环境">创建IDE Debug环境</h3>
<ul>
<li>git clone下代码导入IDEA</li>
<li>在<code>lealone-main</code>模块下增加resources文件夹，将<code>lealone-dist</code>模块下conf文件夹的内容复制到resources下（这一步为了识别log4j的配置文件，可以调整log文件位置）</li>
<li>需要设置<code>lealone.config</code>系统变量，可以通过<code>System.setProperty(&quot;lealone.config&quot;, &quot;file:///D:/path/to/resources/lealone.yaml&quot;);</code>完成（可以参考<code>lealone-dist</code>模块下bin文件夹的脚本内容查看需要的信息）</li>
<li>启动debug模式，配合打包编译后的<code>sqlshell</code>作为客户端。完成debug交互</li>
</ul>
<p>第一步，修改root用户的密码。默认用户为root，密码为空。连接进入后，执行<code>SET PASSWORD 'your-new-password'</code>就可以完成管理员账号的密码设置</p>
<h2 id="how-does-a-relational-database-work">How does a relational database work</h2>
<p>原始文章： <a href="http://coding-geek.com/how-databases-work/?print=print">How does a relational database work</a></p>
<p>英文版本的<a href="https://walleipt.gitbooks.io/how-does-a-relational-database-work/content/">book样式</a></p>
<p>中文版本备份：关于数据库原理的总结<a href="https://zhuanlan.zhihu.com/p/48629562">【一】</a> <a href="https://zhuanlan.zhihu.com/p/48633080">【二】</a></p>
<p>本文主要介绍核心组件以及其中应用到的算法以及使用的数据结构：</p>
<ul>
<li>基础
<ul>
<li>时间复杂度(决定了后续不同场景下需要采用何种算法，以及由于条件限制——时间，CPU，内存等——采用哪种工程实现)</li>
<li>合并排序(分治法)</li>
<li>数据结构：数组，B+树，Hash表</li>
</ul>
</li>
<li>数据库组件总览(参考下图)，然后重点介绍了三个组件——
<ul>
<li>Client Manager</li>
<li>Query Manager</li>
<li>Data Manager</li>
</ul>
</li>
</ul>
<p><img src="https://s3-img.meituan.net/v1/mss_3d027b52ec5a4d589e68050845611e68/ff/n0/0m/kg/8c_288742.jpg@596w_1l.jpg" alt=""></p>
<p>更通用性的框架介绍参考《数据库系统基础教程(A first course in database systems)》中提到的组成</p>
<p><img src="https://s3-img.meituan.net/v1/mss_3d027b52ec5a4d589e68050845611e68/ff/n0/0m/kg/7n_289069.jpg@596w_1l.jpg" alt=""></p>
<ul>
<li>单框表示不同的组件</li>
<li>双框表示内存中的数据结构</li>
<li>实线表示控制和数据流</li>
<li>虚线只表示数据流</li>
</ul>
<p>文中提到的<a href="http://db.cs.berkeley.edu/papers/fntdb07-architecture.pdf">Architecture of a Database System </a>研究论文提到的组件构成——</p>
<p><img src="https://s3-img.meituan.net/v1/mss_3d027b52ec5a4d589e68050845611e68/ff/n0/0m/kg/8v_288731.jpg@596w_1l.jpg" alt=""></p>
<p><a href="https://h2database.com/html/architecture.html">H2 DB Architecture</a> Top-down Overview</p>
<ul>
<li>JDBC driver <code>org.h2.jdbc, org.h2.jdbcx</code></li>
<li>Connection/session management <code>org.h2.engine.Database, org.h2.engine.SessionInterface, org.h2.engine.Session, org.h2.engine.SessionRemote</code></li>
<li>SQL Parser <code>org.h2.command.Parser</code></li>
<li>Command execution and planning <code>org.h2.command.ddl, org.h2.command.dml</code></li>
<li>Table/Index/Constraints <code>org.h2.table, org.h2.index</code></li>
<li>Undo log, redo log, and transactions layer</li>
<li>B-tree engine and page-based storage allocation <code>org.h2.store</code></li>
<li>Filesystem abstraction <code>org.h2.store.FileStore</code></li>
</ul>
<h2 id="olap-vs-oltp">OLAP VS. OLTP</h2>
<h3 id="olap">OLAP</h3>
<p><strong>Online Analytical Processing</strong>, a category of software tools which provide analysis of data for business decisions. OLAP systems allow users to analyze database information from multiple database systems at one time.</p>
<p><strong>The primary objective is data analysis and not data processing</strong>.</p>
<h3 id="oltp">OLTP</h3>
<p><strong>Online Transaction Processing</strong> shortly known as OLTP supports transaction-oriented applications in a 3-tier architecture. OLTP administers day to day transaction of an organization.</p>
<p><strong>The primary objective is data processing and not data analysis</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/3296949-667b7d275ee82eba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>可以认为任何一个数据仓库(Datawarehouse)都是OLAP的。数据库存储的数据用来进行“分析”（Analyze）的。关注数据生成的“事后”分析(Analytical)。</p>
<p>OLTP则强调“事务”（transaction）本身，关注在“业务”进行中的逻辑。例如——在线预订火车票；银行的账单处理。</p>
<blockquote>
<p>ATM center. Assume that a couple has a joint account with a bank. One day both simultaneously reach different ATM centers at precisely the same time and want to withdraw total amount present in their bank account.</p>
</blockquote>
<h2 id="database-vs-schema">Database VS. Schema</h2>
<p><a href="https://www.javatpoint.com/database-vs-schema">Difference between Database and Schema</a></p>
<p>这里的区分是针对<code>database.schema.table</code>这种情况下的区分来说的。</p>
<ul>
<li>database是“实体的”，schema是“表现的”。</li>
<li>前者用来存储结构化的数据；后者描述了数据库的表现形式</li>
<li>前者使用DML<code>data manipulation language</code>来操作数据；后者使用DDL<code>Data Definition Language</code>描述数据库的表现形式</li>
</ul>
<p>只是在Mysql中，这两个概念不做区分<a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_schema"><code>In MySQL, physically, a schema is synonymous with a database.</code></a></p>
<p>可以参考PostgresSQL中的<a href="https://www.javatpoint.com/postgresql-tutorial">PostgreSQL Schema</a>，实现了上述的区别。</p>
<p>这样是在一个数据库中，可以创建不同的schema，然后不同的schema下面可以包含相同的table名称。只是有一个数据库连接就可以为不同用户提供相同的服务</p>
<h2 id="lealone-basic">Lealone basic</h2>
<p><a href="https://github.com/lealone/Lealone-Docs/blob/master/%E5%BA%94%E7%94%A8%E6%96%87%E6%A1%A3/%E7%94%A8%E6%88%B7%E6%96%87%E6%A1%A3.md">用户文档 快速入门</a></p>
<p>安装这个说明进行编译。</p>
<p>下载源码之后，执行 <code>mvn clean package assembly:assembly -Dmaven.test.skip=true</code></p>
<p>遇到的几个小问题：</p>
<ul>
<li>
<ol>
<li><del>Maven编译需要暂时去掉 <code>&lt;module&gt;lealone-test&lt;/module&gt;</code>模块，否则会出现测试脚本失败的情况</del>
这是因为我在Powershell环境下执行<code> mvn clean package assembly:assembly -Dmaven.test.skip=true</code>这个目录导致的。<a href="https://stackoverflow.com/a/6351739/1087122">参考</a>这里，可以看到实际上跳过test的命令并没有生效。需要使用<code>mvn clean package assembly:assembly '-Dmaven.test.skip=true'</code>的方式执行才会生效。</li>
</ol>
</li>
</ul>
<p>效果还是很直接的—— <a href="https://www.jianshu.com/p/54e816217e5f">原文地址</a></p>
<p><img src="https://upload-images.jianshu.io/upload_images/3296949-969f1fe012b279e6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="server 启动"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/3296949-47e28bebab8e205e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="命令行执行"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/3296949-f4cc8a6aa7732925.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="java main方法执行"></p>
<ul>
<li>
<ol start="2">
<li>在linux下执行时注意Java -cp 指定classpath时才有<code>:</code>分割path的路径。同时需要设置环境变量<code>JAVA_HOME</code>。</li>
</ol>
</li>
</ul>
<p>手残，修改环境变量时，最后少打了一个H，<code>export PATH=${JAVA_HOME}/bin:$PATH</code>变成了<code>export PATH=${JAVA_HOME}/bin:$PAT</code>导致所以的命令无法使用。</p>
<p>正常的解决方案：</p>
<blockquote>
<p>使用绝对路径进行操作；<code>/usr/bin/vi /home/geb/.zshrc</code>进行编辑<br>
临时导出新的PATH路径<code>export PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin</code>然后继续操作</p>
</blockquote>
<h2 id="presto">Presto</h2>
<p><a href="https://prestosql.io/docs/current/overview/use-cases.html">Presto is (OLAP) and is Not (OLTP)</a></p>
<blockquote>
<p>Presto is a high performance, distributed SQL query engine for big data. Its architecture allows users to query a variety of data sources such as Hadoop, AWS S3, Alluxio, MySQL, Cassandra, Kafka, and MongoDB. One can even query data from multiple data sources within a single query. Presto is community driven open-source software released under the Apache License.</p>
</blockquote>
<ul>
<li>高性能SQL查询引擎</li>
<li>支持的数据源包括：Hadoop Distributed File System, AWS S3, Alluxio, MySQL, PostgreSQL, Microsoft SQL Server, Amazon Redshift, Apache Kudu, Apache Phoenix, Apache Kafka, Apache Cassandra, Apache Accumulo, MongoDB and Redis等，<a href="https://prestosql.io/docs/current/connector.html">完整列表</a>，目前支持30个不同数据来源</li>
<li>最初由Facebook设计开发，用来查询分析内部存储在Hadoop上的数据，(数据太大，嫌弃Hive太慢）</li>
<li>2012年开发使用；2013年开源；2014年Netflix应用presto来查询存储在AWS S3上的10PB级别的数据</li>
<li>2019年1月成立Presto Software Foundation以继续开发Presto引擎；PrestoDB(presto的FB内部版本)依然由Facebook开发</li>
<li>2019年9月，FB将PrestoDB贡献给Linux基金会，建立Presto Foundation</li>
</ul>
<table>
<thead>
<tr>
<th>Site</th>
<th>Foundation</th>
<th>Source</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://prestosql.io">https://prestosql.io</a></td>
<td>Presto Software Foundation</td>
<td><a href="https://github.com/prestosql/presto">https://github.com/prestosql/presto</a></td>
</tr>
<tr>
<td><a href="https://prestodb.io">https://prestodb.io</a></td>
<td>Presto Foundation</td>
<td><a href="https://github.com/prestodb/presto">https://github.com/prestodb/presto</a></td>
</tr>
</tbody>
</table>
<ul>
<li>prestosql.io是正常的企业开发，开源，社区驱动</li>
<li>prestdb.io是<a href="https://www.linuxfoundation.org/press-release/2019/09/facebook-uber-twitter-and-alibaba-form-presto-foundation-to-tackle-distributed-data-processing-at-scale/">大企业联合</a></li>
<li><a href="https://github.com/prestosql/presto/issues/380">#issue380 in prestosql.io: What is the relationship of prestosql and prestodb?</a></li>
<li><a href="https://yuzhouwan.com/posts/200906">Presto：分布式 SQL 查询引擎</a></li>
</ul>
<blockquote>
<p>Presto 采用 MPP（Massively Parallel Processing）大规模并行处理架构，来解决大量数据分析的场景。该架构的主要特征，如下：</p>
<ul>
<li>任务并行执行</li>
<li>分布式计算</li>
<li>Shared Nothing</li>
<li>横向扩展</li>
<li>数据分布式存储（本地化）</li>
</ul>
</blockquote>
<blockquote>
<p>Presto 采用 SPI（Service Provider Interface）服务提供发现机制，来插件化地支持多种数据源，以实现联邦查询（Federation Query，指能够通过一条 SQL 查询，对处于完全不同的系统中的不同的数据库和模式，进行引用和使用）</p>
</blockquote>
<h3 id="data-function">data function</h3>
<p>官方文档：<a href="https://prestodb.io/docs/current/functions/datetime.html">8.13. Date and Time Functions and Operators</a></p>
<p>The <code>date_trunc</code> function supports the following units:</p>
<table>
<thead>
<tr>
<th>Unit</th>
<th>Example Truncated Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>second</td>
<td>2001-08-22 03:04:05.000</td>
</tr>
<tr>
<td>minute</td>
<td>2001-08-22 03:04:00.000</td>
</tr>
<tr>
<td>hour</td>
<td>2001-08-22 03:00:00.000</td>
</tr>
<tr>
<td>day</td>
<td>2001-08-22 00:00:00.000</td>
</tr>
<tr>
<td>week</td>
<td>2001-08-20 00:00:00.000</td>
</tr>
<tr>
<td>month</td>
<td>2001-08-01 00:00:00.000</td>
</tr>
<tr>
<td>quarter</td>
<td>2001-07-01 00:00:00.000</td>
</tr>
<tr>
<td>year</td>
<td>2001-01-01 00:00:00.000</td>
</tr>
</tbody>
</table>
<p>The above examples use the timestamp <code>2001-08-22 03:04:05.321</code> as the input.</p>
<p>使用实例：<a href="https://mode.com/blog/date-trunc-sql-timestamp-function-count-on/">DATE_TRUNC: A SQL Timestamp Function You Can Count On</a></p>
<p><code>date_format(timestamp, format)</code> → <code>varchar</code>. Formats timestamp as a string using format.
<code>from_unixtime(unixtime)</code> → timestamp. Returns the UNIX timestamp unixtime as a timestamp.</p>
<p>上面两个方法组合使用，得到——
<a href="http://evafengeva.blogspot.com/2017/09/how-to-convert-milliseconds-or-seconds.html">How to convert milliseconds or seconds into date format in Presto?</a></p>
<p>Milliseconds:<br>
<code>DATE_FORMAT(FROM_UNIXTIME(column_name /1000),'%Y-%m-%d')</code>
Seconds:<br>
<code>DATE_FORMAT(FROM_UNIXTIME(column_name),'%Y-%m-%d')</code></p>
<p>Please note that &lsquo;/1000&rsquo; should be added when it converts milliseconds to human-readable format.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">when</span> wait_duration <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1800000</span> <span style="color:#66d9ef">then</span> <span style="color:#e6db74">&#39;30m以上&#39;</span>
            <span style="color:#66d9ef">when</span> wait_duration <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1800000</span> <span style="color:#66d9ef">and</span> wait_duration <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">600000</span> <span style="color:#66d9ef">then</span> <span style="color:#e6db74">&#39;10~30m&#39;</span>
            <span style="color:#66d9ef">when</span> wait_duration <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">600000</span> <span style="color:#66d9ef">and</span> wait_duration <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">60000</span> <span style="color:#66d9ef">then</span> <span style="color:#e6db74">&#39;1~10m&#39;</span>
            <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#39;1m以下&#39;</span>
           <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">as</span> wsec, <span style="color:#66d9ef">count</span>(<span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">AS</span> num, substr(created_at,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">10</span>) <span style="color:#66d9ef">as</span> date
<span style="color:#66d9ef">FROM</span>
  service_su_result_day
<span style="color:#66d9ef">WHERE</span> dt <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;${date_y_m_d}&#39;</span>
<span style="color:#75715e">-- https://dba.stackexchange.com/a/106798
</span><span style="color:#75715e"></span><span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> substr(created_at,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">10</span>),<span style="color:#66d9ef">case</span> <span style="color:#66d9ef">when</span> wait_duration <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1800000</span> <span style="color:#66d9ef">then</span> <span style="color:#e6db74">&#39;30m以上&#39;</span>
            <span style="color:#66d9ef">when</span> wait_duration <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1800000</span> <span style="color:#66d9ef">and</span> wait_duration <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">600000</span> <span style="color:#66d9ef">then</span> <span style="color:#e6db74">&#39;10~30m&#39;</span>
            <span style="color:#66d9ef">when</span> wait_duration <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">600000</span> <span style="color:#66d9ef">and</span> wait_duration <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">60000</span> <span style="color:#66d9ef">then</span> <span style="color:#e6db74">&#39;1~10m&#39;</span>
            <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#39;1m以下&#39;</span>
           <span style="color:#66d9ef">end</span>
</code></pre></div>
  
  

  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="http://gebitang.com/post/2021/may-and-june/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="http://gebitang.com/post/2021/may-and-june/">May and June Run</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="http://gebitang.com/post/how/jira/">JIRA API</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="http://gebitang.com/post/how/jira/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'gebitang';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</div>

</div>
</div>
<script src="http://gebitang.com/js/ui.js"></script>
<script src="http://gebitang.com/js/menus.js"></script>


<script>
  
  if (window.location.hostname != "localhost") {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-34303694-1', 'auto');
    ga('send', 'pageview');
  }
</script>




<button onclick="topFunction()" id="myBtn" title="Go to top">Top</button>
</body>
</html>

