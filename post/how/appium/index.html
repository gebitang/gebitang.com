<!doctype html><html xmlns:wb=http://open.weibo.com/wb lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=Content-Security-Policy content="upgrade-insecure-requests"><meta name=description content="YKYL"><meta name=generator content="Hugo 0.123.8"><title>Appium, Android, iOS &#183; 戈壁堂</title>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css><!--[if lte IE 8]><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css><!--<![endif]--><!--[if lte IE 8]><link rel=stylesheet href=http://gebitang.com/css/side-menu-old-ie.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=http://gebitang.com/css/side-menu.css><!--<![endif]--><link rel=stylesheet href=http://gebitang.com/css/blackburn.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.9.0/css/all.css><link href="https://fonts.googleapis.com/css?family=Raleway" rel=stylesheet type=text/css><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js></script><script>hljs.initHighlightingOnLoad()</script><link rel="shortcut icon" href=http://gebitang.com/img/favicon.ico type=image/x-icon><link rel=stylesheet href=http://gebitang.com/css/my.css><script src=http://gebitang.com/js/my.js></script></head><body><div id=layout><a href=#menu id=menuLink class=menu-link><span></span></a><div id=menu><a class="pure-menu-heading brand" href=http://gebitang.com/>Gebitang</a><div class=pure-menu><ul class=pure-menu-list><li class=pure-menu-item><a class=pure-menu-link href=http://gebitang.com/><i class='fa fa-home fa-fw'></i>Home</a></li><li class=pure-menu-item><a class=pure-menu-link href=http://gebitang.com/post/><i class='fa fa-list fa-fw'></i>Posts</a></li><li class=pure-menu-item><a class=pure-menu-link href=http://gebitang.com/about/><i class='fa fa-user fa-fw'></i>About</a></li><li class=pure-menu-item><a class=pure-menu-link href=http://gebitang.com/contact/><i class='fa fa-phone fa-fw'></i>Contact</a></li><li class=pure-menu-item><a class=pure-menu-link href=http://gebitang.com/tags/><i class='fa fa-tags fa-fw'></i>Tags</a></li><li class=pure-menu-item><a class=pure-menu-link href=http://gebitang.com/topics/><i class='fa fa-folder fa-fw'></i>Topics</a></li></ul></div><div class="pure-menu social"><ul class=pure-menu-list></ul></div><div><div class=small-print><small><a rel=license href=http://creativecommons.org/licenses/by/4.0/><img alt=知识共享许可协议 style=border-width:0 src=https://i.creativecommons.org/l/by/4.0/80x15.png></a><br>本<span xmlns:dct=http://purl.org/dc/terms/ href=http://purl.org/dc/dcmitype/Text rel=dct:type>作品</span>由<a xmlns:cc=http://creativecommons.org/ns# href=http://gebitang.com property="cc:attributionName" rel=cc:attributionURL>&nbsp;Gebitang&nbsp;&nbsp;</a>采用<a rel=license href=http://creativecommons.org/licenses/by/4.0/>知识共享署名 4.0 国际许可协议</a>进行许可&nbsp;&copy; 2018</small></div><div class=small-print><small></small></div><div class=small-print><small>Built with&nbsp;<a href=https://gohugo.io/ target=_blank>Hugo</a></small>
<small>Theme&nbsp;<a href=https://github.com/yoshiharuyamashita/blackburn target=_blank>Blackburn</a></small></div><div style=display:none><div class=small-print><small><wb:follow-button uid=2446212465 type=red_1 width=67 height=24></wb:follow-button></small></div></div></div></div><div id=main><div class=header><h1>Appium, Android, iOS</h1><h2>YKYL</h2></div><div class=content><div class=post-meta><div><i class="fa fa-calendar fa-fw"></i>
<time>2023-09-19</time></div><div><i class="fa fa-folder fa-fw"></i>
<a class=post-taxonomy-topic href=http://gebitang.com/topics/appium>appium</a></div><div><i class="fa fa-tags fa-fw"></i>
<a class=post-taxonomy-tag href=http://gebitang.com/tags/appium>appium</a></div></div><nav id=TableOfContents><ul><li><a href=#appium20>appium2.0</a><ul><li><a href=#从appium-1x-迁移到-appium-2x>从appium 1.x 迁移到 appium 2.x</a></li><li><a href=#覆盖旧版本>覆盖旧版本</a></li><li><a href=#appium-是否需要每次都编译wda项目>appium 是否需要每次都编译wda项目</a></li><li><a href=#低版本xcode编译wda提示>低版本xcode编译wda提示</a></li><li><a href=#appium-for-android-14>appium for android 14</a></li></ul></li><li><a href=#curl-调用api>curl 调用api</a></li><li><a href=#wda>WDA</a><ul><li><a href=#510版本使用xcode-15编译成功无法启动>5.10版本使用xcode 15编译成功，无法启动</a></li><li><a href=#wda提示-端口占用>WDA提示 端口占用——</a></li><li><a href=#证书信任>证书信任</a></li><li><a href=#使用缓存build的wda>使用缓存build的wda</a></li><li><a href=#libimobiledevice-系列>libimobiledevice 系列</a></li><li><a href=#appium-webdriveragent-项目构建>appium-webdriveragent 项目构建</a></li></ul></li><li><a href=#环境搭建>环境搭建</a><ul><li><a href=#多版本支持>多版本支持</a></li><li><a href=#指定appium使用的xcode版本>指定appium使用的Xcode版本</a></li><li><a href=#node环境>node环境</a></li><li><a href=#install-dmg>install dmg</a></li><li><a href=#permission-denial>Permission denial</a></li><li><a href=#安装libimobiledevice-最新版本>安装libimobiledevice 最新版本</a></li><li><a href=#手动搬运mac环境下的appium>手动搬运Mac环境下的appium</a></li><li><a href=#脚本编写>脚本编写</a></li><li><a href=#命令行方式执行>命令行方式执行</a></li><li><a href=#打包wda>打包WDA</a><ul><li><a href=#xcode提示codesign-想要访问您的钥匙串中的密钥>Xcode提示“codesign 想要访问您的钥匙串中的密钥”</a></li><li><a href=#安装wda时报错-the-code-signature-version-is-no-longer-supported>安装WDA时报错 “The code signature version is no longer supported”</a></li><li><a href=#xcode-140打包wda报错>Xcode 14.0打包WDA报错</a></li></ul></li><li><a href=#现状总结>现状总结</a></li></ul></li></ul></nav><h2 id=appium20>appium2.0</h2><ul><li><a href=https://appium.io/docs/en/contributing-to-appium/appium-from-source/>Running Appium from Source</a></li><li><a href=https://appium.io/docs/en/contributing-to-appium/appium-packages/index.html>Appium in a Nutshell</a>，架构关系图</li><li>2.0依赖node 14+ 和 npm 8+</li><li>至今（2023-01-16）由于对应的文档还没准备好，<a href=https://github.com/appium/appium/discussions/15828>尚未正式发布</a></li><li>关键修改是将不同的包进行独立管理，启用了默认变量<code>$APPIUM_HOME</code> = <code>~/.appium</code>，将会在这里管理各种插件和驱动<ul><li>appium driver list</li><li>appium plugin list</li></ul></li></ul><p>使用nvm安装到话，会自动替换appium的软连接。</p><pre tabindex=0><code>➜  ~ npm install -g appium@next
➜  ~ appium -v
2.0.0-beta.52
➜  ~ which appium
/Users/geb/.nvm/versions/node/v16.17.1/bin/appium
➜  ~ appium -g /tmp/appium2.log
[Appium] Welcome to Appium v2.0.0-beta.52 (REV 9600617c52d0d2e48493424c529ac6c945d2775b)
[Appium] Appium REST http interface listener started on 0.0.0.0:4723
[Appium] No drivers have been installed in /Users/geb/.appium. Use the &#34;appium driver&#34; command to install the one(s) you want to use.
[Appium] No plugins have been installed. Use the &#34;appium plugin&#34; command to install the one(s) you want to use.

^C[Appium] Received SIGINT - shutting down
[debug] [AppiumDriver@9511] There are no active sessions for cleanup
[HTTP] Waiting until the server is closed
[HTTP] Received server close event
</code></pre><p>nvm管理不同的文件夹以支持不同版本的node；安装的应用连接到对应的bin目录下。</p><pre tabindex=0><code>➜  ~ ls -l /Users/geb/.nvm/versions/node/v16.17.1/bin/
total 152400
lrwxr-xr-x@ 1 geb  staff        35 Jan 16 15:10 appium -&gt; ../lib/node_modules/appium/index.js
lrwxr-xr-x  1 geb  staff        45 Sep 23 10:44 corepack -&gt; ../lib/node_modules/corepack/dist/corepack.js
-rwxr-xr-x  1 geb  staff  78027072 Sep 23 10:44 node
lrwxr-xr-x  1 geb  staff        38 Sep 23 10:44 npm -&gt; ../lib/node_modules/npm/bin/npm-cli.js
lrwxr-xr-x  1 geb  staff        38 Sep 23 10:44 npx -&gt; ../lib/node_modules/npm/bin/npx-cli.js
</code></pre><p>独立安装driver和plgin，检查对应依赖是否下载完整（首次安装手动结束后，只有文件夹好像也被认为安装成功，但启动appium后会报错。卸载重新安装对应的driver即可）</p><pre tabindex=0><code>➜  ~ appium driver install xcuitest
✔ Installing &#39;xcuitest&#39; using NPM install spec &#39;appium-xcuitest-driver&#39;
ℹ Driver xcuitest@4.16.9 successfully installed
- automationName: XCUITest
- platformNames: [&#34;iOS&#34;,&#34;tvOS&#34;]
➜  ~ appium driver install uiautomator2
✔ Installing &#39;uiautomator2&#39; using NPM install spec &#39;appium-uiautomator2-driver&#39;
ℹ Driver uiautomator2@2.12.2 successfully installed
- automationName: UiAutomator2
- platformNames: [&#34;Android&#34;]
</code></pre><p>已经安装了 2.0的beta版本，可以直接升级 <code>npm i --location=global appium</code> &ndash;> <code>2.0.0-beta.52 --> 2.1.3</code>(目前的最新版本230926)</p><h3 id=从appium-1x-迁移到-appium-2x>从appium 1.x 迁移到 appium 2.x</h3><p>升级须知——</p><ul><li>有哪些不兼容的设置，参考<a href=https://appium.github.io/appium/docs/en/2.0/guides/migrating-1-to-2/#breaking-changes>Breaking Changes</a></li><li>针对这些不兼容的点，目前项目中是否涉及到，如果改造？ one by one</li><li>除了不兼容的部分，项目中哪些功能依赖到appium到哪些功能？</li><li>升级后这些功能点是否依然正常？ one by one</li></ul><p><strong>Breaking Changes</strong></p><ul><li>默认的server base path，之前为<code>/wd/hub</code>，现在不需要了，可以使用 <code>appium --base-path=/wd/hub</code>进行设置兼容，不需要修改项目中的设置</li><li>driver的安装和目录</li></ul><p>1.0 所有的driver和主程序是一起安装的，默认的安装目录在 <code>/path/to/appium/node_modules</code>，例如 <code>/path/to/appium/node_modules/appium-xcuitest-driver/node_modules/appium-webdriveragent</code><br>2.0 主程序与driver分离，可以单独指定安装所需的driver， 引入新的变量 <code>$APPIUM_HOME</code>，wda的目录在<code>$APPIUM_HOME/node_modules/appium-xcuitest-driver/node_modules/appium-webdriveragent</code></p><ul><li>driver的命令行参数——可忽略，未使用</li><li>driver的自动化参数——可忽略，只是返回code不一致</li><li>driver升级：之前只能随appium一起升级；现在可以独立升级，例如 <code>appium driver update xcuitest</code></li><li>协议变更： 2.0依然支持旧的client端。appium api基于 <a href=https://www.w3.org/TR/webdriver/>W3C WebDriver Protocol</a>，包括"JSONWP" (JSON Wire Protocol) and &ldquo;MJSONWP&rdquo; (Mobile JSON Wire Protocol)</li><li>Capabilities 变更较大，但依然支持旧版本的格式（因为官方维护的client已经默认采用2.0的方式）</li></ul><p>标准的capabilities，即官方W3C WebDriver Protocol中指定的capabilities，依然保持现有格式；其他的capabilities必须知道前缀<code>appium:</code>，例如 <code>appium:app</code>。所有不支持W3C协议的WebDriver客户端将不能创建appium session，可以以类似如下的方式做兼容</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;platformName&#34;</span>: <span style=color:#e6db74>&#34;iOS&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;browserName&#34;</span>: <span style=color:#e6db74>&#34;Safari&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;appium:options&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;platformVersion&#34;</span>: <span style=color:#e6db74>&#34;14.4&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;deviceName&#34;</span>: <span style=color:#e6db74>&#34;iPhone 11&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;automationName&#34;</span>: <span style=color:#e6db74>&#34;XCUITest&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>不再支持的命令（待更新）包括——所有变更到driver层实现的；属于老版本但不属于 W3C Protocol 的。 ——可忽略，未使用</li><li>图片分析功能提取到plugin中实现 —— 确认没有使用 appium的&rsquo;以图定位元素&rsquo;api的话，可忽略</li><li>执行driver 脚本 —— 未使用，可忽略</li><li>不支持的参数列表？——针对配置文件的，可忽略</li><li>删除老的driver，本身也不再使用 ——可忽略</li><li>内部包重命名，例如 <code>appium-base-driver</code> &ndash;> <code>@appium/base-driver</code></li><li><a href=https://github.com/admc/wd>&ldquo;WD&rdquo;</a> javascrip 客户端不再支持，推荐使用 <a href=https://webdriver.io/>WebdriverIO</a></li><li><a href=https://github.com/appium/appium-inspector>Appium Inspector</a> 变更为独立的app，不再依赖 <a href=https://github.com/appium/appium-desktop>GUI Appium Desktop</a>。需要注意，Desktop版本低于1.21的依赖WD 客户端，所以不兼容2.0</li></ul><p><strong>新Feature</strong></p><ul><li>支持独立的<a href=https://appium.github.io/appium/docs/en/2.0/guides/config/>配置文件</a></li><li>可定制 <a href=https://appium.github.io/appium/docs/en/2.0/ecosystem/build-plugins/>server 插件</a></li><li>自由独立安装 driver，<a href=https://appium.github.io/appium/docs/en/2.0/ecosystem/build-drivers/>定制driver</a></li></ul><p><a href=https://www.npmjs.com/package/appium>升级</a>前需要确保1.x版本被彻底删除。目前还是需要先指定next方式 <code>npm install --location global appium@next</code>，目前可以按照2.0.1版本，然后再升级 <code>npm install --location=global appium@latest</code> 到最新版本</p><p>安装driver时注意npm到registry源地址，似乎只有官方的源才能获取到对应的driver。</p><p>临时使用<code>npm --registry https://registry.npmjs.org install --location global appium@next</code>
持久使用 <code>npm config set registry https://registry.npmjs.org</code></p><p><code>appium/build/lib</code>下是依据编译后的js代码；<code>appium/lib</code>下是真正的源码。</p><h3 id=覆盖旧版本>覆盖旧版本</h3><p>如果旧版本已经在 <code>/usr/local/bin/appium</code> 存在，而新版本安装在了用户目录下。</p><p>新版本升级完成之后——</p><ul><li>先删除对应的<code>/usr/local/bin/appium</code> 和指向的appiumm目录</li><li>再将用户目录下的 <code>bin/appium</code> 和指向的软连接文件 <code>../lib/node_modules/appium/build/lib/main.js</code> 中的appium目录都复制</li><li>如果提示 Permission Denied 问题，执行 <code>sudo chmod +x /usr/local/bin/appium</code></li></ul><p>检查版本。</p><h3 id=appium-是否需要每次都编译wda项目>appium 是否需要每次都编译wda项目</h3><p><a href=https://github.com/appium/appium/issues/12259>Could not reuse existing WDA on real iPhone device.</a></p><h3 id=低版本xcode编译wda提示>低版本xcode编译wda提示</h3><p><a href=https://github.com/appium/appium/issues/14952>[Xcode 12.3] WebDriverAgent.xcodeproj Building for iOS, but the embedded framework &lsquo;YYCache.framework&rsquo; was built for iOS + iOS Simulator.</a></p><p>本地复现环境：xcode 12.5.1 + appium 1.15.0， 升级到1.22.0之后问题不再复现。</p><p>fix：将编译选项的 <code>Validate Workplace</code>从 No 变更为 YES</p><h3 id=appium-for-android-14>appium for android 14</h3><p>权限问题：<code>SecurityException: Permission denial: writing to settings requires:android.permission.WRITE_SECURE_SETTINGS</code></p><p><a href=https://github.com/appium/appium/issues/13802>issue: 13802</a>， 以及<a href=https://discuss.appium.io/t/i-am-getting-following-error-while-executing-appium-java-script/>appium论坛讨论</a></p><p>不同设备有对应的设置：</p><ul><li>Oppo/一加：开发者权限&ndash;禁止权限监控 开启</li><li>如果有：开启 “USB调试(安全设置)”选型</li><li>如果有，关闭 “USB验证App”( Verify apps over USB.) 以及 “验证可调试应用的字节码”(Verify bytecode of debuggable apps)
上述操作设置之后，需要重启手机方可使用</li></ul><p>目前的问题：</p><ol><li>只能第一次初始化成功：可以获取截图+页面信息。</li><li>无法点击，总是提示超时</li><li>无法刷新，提示截图失败</li></ol><p>从日志看——</p><ul><li>appium端：手机端端socket被挂起，截图请求出现异常</li></ul><pre tabindex=0><code>[AndroidUiautomator2Driver@8b7b (38654284)] socket hang up
[debug] [AndroidUiautomator2Driver@8b7b (38654284)] Encountered internal error running command: UnknownError: An unknown server-side error occurred while processing the command. Original error: Could not proxy command to the remote server. Original error: socket hang up
[debug] [AndroidUiautomator2Driver@8b7b (38654284)]     at UIA2Proxy.command (/Users/zhiwei/.nvm/versions/node/v18.13.0/lib/node_modules/appium/node_modules/@appium/base-driver/lib/jsonwp-proxy/proxy.js:342:13)
[debug] [AndroidUiautomator2Driver@8b7b (38654284)]     at processTicksAndRejections (node:internal/process/task_queues:95:5)
[debug] [AndroidUiautomator2Driver@8b7b (38654284)]     at AndroidUiautomator2Driver.commands.click (/Users/zhiwei/.appium/node_modules/appium-uiautomator2-driver/lib/commands/element.js:81:10)
[AndroidUiautomator2Driver@de2f (7254fcfd)] socket hang up
[debug] [AndroidUiautomator2Driver@8b7b (38654284)] Responding to client with driver.getTimeouts() result: {&#34;command&#34;:3600000,&#34;implicit&#34;:0}
[debug] [AndroidUiautomator2Driver@8b7b (38654284)] Matched &#39;/screenshot&#39; to command name &#39;getScreenshot&#39;
[debug] [AndroidUiautomator2Driver@8b7b (38654284)] Proxying [GET /screenshot] to [GET http://127.0.0.1:8200/session/182ec5cb-2b58-4647-98f1-f535accd800f/screenshot] with no body
[debug] [AndroidUiautomator2Driver@8b7b (38654284)] Responding to client with driver.getTimeouts() result: {&#34;command&#34;:3600000,&#34;implicit&#34;:0}
[AndroidUiautomator2Driver@8b7b (38654284)] socket hang up
</code></pre><ul><li>device端：刚启动之后，uia2的server被强制停止了</li></ul><pre tabindex=0><code>06-15 11:36:11.535 D/OplusSmartBrightnessController( 3334): handleMessage MSG_LUX_CHANGED, mLux:162.66734 luxQueue=[162.0, 163.0, 163.0, 162.0, 163.0, 163.0]
06-15 11:36:11.539 D/AndroidRuntime(13475): Calling main entry com.android.commands.am.Am
06-15 11:36:11.544 D/UiAutomationConnection(13475): Created on user UserHandle{0}
06-15 11:36:11.545 I/ActivityManager( 3334): Force stopping io.appium.uiautomator2.server appid=10321 user=0: start instr
06-15 11:36:11.567 E/ActivityManager( 3334): Unable to freeze binder for 12200: -11
06-15 11:36:11.569 D/OplusUIFirst_FB( 3334): io.appium.uiautomator2.server remove pid: 12200
06-15 11:36:11.572 I/ActivityManager( 3334): Killing 12200:io.appium.uiautomator2.server/u0a321 (adj 0): stop io.appium.uiautomator2.server due to start instr
06-15 11:36:11.574 E/IHansComunication( 9664): HANS printMessageBody: RCV message: type = 3,port = 86870,caller_pid = 3334,caller_uid = 1000,target_pid = 12200,target_uid = 10321,pkg_cmd = -1,rpc = signal/9
06-15 11:36:11.578 I/OplusHansManager ( 3334): onUidGone(), 10321 io.appium.uiautomator2.server exit SM
06-15 11:36:11.579 I/OplusHansManager ( 3334): uid=10321, pkg=io.appium.uiautomator2.server F exit SM
06-15 11:36:11.579 I/OplusHansManager ( 3334): uid=10321, pkg=io.appium.uiautomator2.server F exit(), F stay=196, reason=UidGone
06-15 11:36:11.580 I/OplusHansManager ( 3334): unfreeze uid: 10321 io.appium.uiautomator2.server pids: [12200] reason: UidGone scene: LcdOn
06-15 11:36:11.580 I/OplusHansManager ( 3334): uid=10321, pkg=io.appium.uiautomator2.server M exit(), M stay=0
06-15 11:36:11.580 I/OplusHansManager ( 3334): uid=10321, pkg=io.appium.uiautomator2.server R exit(), R stay=0
06-15 11:36:11.582 D/SensorService( 3334): onUidStateChanged uid = 10321, state = UID_STATE_IDLE
06-15 11:36:11.583 D/DisplayManagerService( 3334): Drop pending events for gone uid 10321
</code></pre><h2 id=curl-调用api>curl 调用api</h2><p><a href=https://www.headspin.io/blog/controlling-appium-via-raw-http-requests-with-curl>Controlling Appium via raw HTTP requests with curl</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 0. Check the Appium server is online</span>
</span></span><span style=display:flex><span>&gt; curl http://localhost:4723/wd/hub/status
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># response:</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;value&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;build&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;version&#34;</span>:<span style=color:#e6db74>&#34;1.17.0&#34;</span><span style=color:#f92672>}}</span>,<span style=color:#e6db74>&#34;sessionId&#34;</span>:null,<span style=color:#e6db74>&#34;status&#34;</span>:0<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 1. Create a new session</span>
</span></span><span style=display:flex><span>&gt; curl -H <span style=color:#e6db74>&#39;Content-type: application/json&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>       -X POST <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>       http://localhost:4723/wd/hub/session <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>       -d <span style=color:#e6db74>&#39;{&#34;capabilities&#34;: {&#34;alwaysMatch&#34;: {&#34;platformName&#34;: &#34;iOS&#34;, &#34;platformVersion&#34;: &#34;13.3&#34;, &#34;browserName&#34;: &#34;Safari&#34;, &#34;deviceName&#34;: &#34;iPhone 11&#34;}}}&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># response:</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;value&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;capabilities&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;webStorageEnabled&#34;</span>:false,<span style=color:#e6db74>&#34;locationContextEnabled&#34;</span>:false,<span style=color:#e6db74>&#34;browserName&#34;</span>:<span style=color:#e6db74>&#34;Safari&#34;</span>,<span style=color:#e6db74>&#34;platform&#34;</span>:<span style=color:#e6db74>&#34;MAC&#34;</span>,<span style=color:#e6db74>&#34;javascriptEnabled&#34;</span>:true,<span style=color:#e6db74>&#34;databaseEnabled&#34;</span>:false,<span style=color:#e6db74>&#34;takesScreenshot&#34;</span>:true,<span style=color:#e6db74>&#34;networkConnectionEnabled&#34;</span>:false,<span style=color:#e6db74>&#34;platformName&#34;</span>:<span style=color:#e6db74>&#34;iOS&#34;</span>,<span style=color:#e6db74>&#34;platformVersion&#34;</span>:<span style=color:#e6db74>&#34;13.3&#34;</span>,<span style=color:#e6db74>&#34;deviceName&#34;</span>:<span style=color:#e6db74>&#34;iPhone 11&#34;</span>,<span style=color:#e6db74>&#34;udid&#34;</span>:<span style=color:#e6db74>&#34;140472E9-8733-44FD-B8A1-CDCFF51BD071&#34;</span><span style=color:#f92672>}</span>,<span style=color:#e6db74>&#34;sessionId&#34;</span>:<span style=color:#e6db74>&#34;ac3dbaf9-3b4e-43a2-9416-1a207cdf52da&#34;</span><span style=color:#f92672>}}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># save session id</span>
</span></span><span style=display:flex><span>&gt; export sid<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ac3dbaf9-3b4e-43a2-9416-1a207cdf52da&#34;</span>
</span></span></code></pre></div><h2 id=wda>WDA</h2><p><a href=https://github.com/appium/appium-xcuitest-driver/blob/master/docs/wda-custom-server.md>How To Set Up And Customize WebDriverAgent Server</a> 入门文档。</p><ul><li>appium在ios端使用WDA作为后端server； wda基于XCTest framework</li></ul><p>设置——</p><ul><li>使用Xcode打开WDA工程</li><li>选择 WebDriverAgentRunner 项目</li><li>选择 设备 作为 测试目标</li><li>选择 <code>Product --> Test</code></li></ul><p>启动——可以使用多种启动方式</p><ul><li><a href=https://github.com/libimobiledevice/libusbmuxd#iproxy>iproxy</a>, 使用xcodebuild命令行启动，然后使用iproxy转发端口请求</li><li><a href=https://github.com/danielpaulus/go-ios>go-ios</a></li><li><a href=https://github.com/alibaba/taobao-iphone-device>tidevice</a> 进行启动，WDA已经安装的情况下 <code>tidevice xctest -B com.facebook.wda.WebDriverAgent.Runner</code></li></ul><p>前提是针对iOS项目已经有通用的签名证书并设置了对应的bundleId等信息。</p><p><a href=https://github.com/alibaba/taobao-iphone-device/issues/349#issuecomment-1733250910>#349 tidevice issue</a></p><ul><li><p>Looks like iOS 17 is using a new device connectivity stack (named CoreDevice), changes involves:</p><ul><li><a href=https://github.com/doronz88/pymobiledevice3/blob/master/misc/RemoteXPC.md>communication protocol</a></li><li>A github <a href=https://github.com/doronz88/pymobiledevice3/pull/463/files>PR</a> in pymobiledevice3 to support mounting &ldquo;new&rdquo; developer images on iOS 17.</li></ul></li><li><p>A libimobiledevice <a href=https://github.com/libimobiledevice/libimobiledevice/issues/1452>issue</a> that records some investigation. Looks like this <a href=https://github.com/libimobiledevice/libimobiledevice/issues/1452#issuecomment-1638859453>comment</a> has fixed a part of controlling features in pymobiledevice3</p></li><li><p>go-ios <a href=https://github.com/danielpaulus/go-ios/issues/265>issue</a></p></li><li><p>appium <a href=https://github.com/appium/appium/issues/18749>issue</a></p></li></ul><h3 id=510版本使用xcode-15编译成功无法启动>5.10版本使用xcode 15编译成功，无法启动</h3><p>提示内容类似——手动点击icon启动，会弹框提示“需要联网进行认证"，联网后会自动激活。</p><pre tabindex=0><code>The request to open &#34;com.geb.test.WebDriverAgentRunner.xctrunner&#34; failed.
Domain: IDELaunchCoreDevice
Code: 0
Recovery Suggestion: Verify that the Developer App certificate for your account is trusted on your device. Open Settings on the device and navigate to General -&gt; VPN &amp; Device Management, then select your Developer App certificate to trust it.
User Info: {
    DVTErrorCreationDateKey = &#34;2023-09-26 04:06:58 +0000&#34;;
    IDERunOperationFailingWorker = IDELaunchCoreDeviceWorker;
}
</code></pre><h3 id=wda提示-端口占用>WDA提示 端口占用——</h3><blockquote><p>The port #xxxx is occupied by an other process.xxxx</p></blockquote><p>跟踪了半天，是由于最初是由root用户启动的，执行的iproxy转发也是root用户下的。切换用户之后，<code>lsof -I:xxx</code>是看不见root用户启动的进程，但系统端口被占用是可以检测到</p><p>tidevice启动wda时也会报错 <code>sock.bind() Address already in use</code></p><p>端口被占用是个基础问题</p><h3 id=证书信任>证书信任</h3><p>企业级证书需要先添加到信任列表之后，才能通过WDA启动起来，否则将会超时报错。 <code>NoHttpResponseException: xxx failed to respond</code></p><ul><li>低版本：“设置”>“通用”>“关于本机”>“证书信任设置”。在“针对根证书启用完全信任”下，开启对这个证书的信任。</li><li>高版本：“设置”>“通用”>“VPN与设备管理”。在“企业级App”下，开启对这个证书的信任。（不同的应用可能使用了不同的企业级证书）</li></ul><h3 id=使用缓存build的wda>使用缓存build的wda</h3><ul><li><a href=https://kazucocoa.wordpress.com/2019/03/15/appium-prevent-building-wda-with-usexctestrunfile-or-useprebuiltwda/>Prevent building WDA with useXctestrunFile or usePrebuiltWDA</a></li><li><a href=https://kazucocoa.wordpress.com/2019/03/23/appiumre-use-existing-wda-in-create-session-command/>Re-use existing WDA in create session command</a></li></ul><p>待验证。。。</p><h3 id=libimobiledevice-系列>libimobiledevice 系列</h3><p><a href=https://github.com/libimobiledevice>github libimobiledevice</a> A cross-platform FOSS library written in C to communicate with iOS devices natively. <a href=https://libimobiledevice.org/>official site: libimobiledevice.org</a></p><p>包含多个类库——</p><ul><li><a href=https://github.com/libimobiledevice/usbmuxd/>usbmuxd</a> 基础库 A socket daemon to multiplex connections from and to iOS devices.<ul><li>上层库 <a href=https://github.com/libimobiledevice/libimobiledevice>libimobiledevice</a> A library to communicate with services on iOS devices using native protocols. 包括多种工具与iOS设备交互，例如 idevice_id，ideviceinfo， idevicescreenshot， ideviceprovision 等</li><li>底层库 <a href=https://github.com/libimobiledevice/libusbmuxd>libusbmuxd</a> A client library for applications to handle usbmux protocol connections with iOS devices. 包括 iproxy，inetcat工具</li></ul></li></ul><p><a href=https://jon-gabilondo-angulo-7635.medium.com/understanding-usbmux-and-the-ios-lockdown-service-7f2a1dfd07ae>Understanding usbmux and the iOS lockdown service</a> 介绍底层机制</p><p><a href=https://daniel-paulus.medium.com/automate-ios-devices-the-almost-mac-free-way-973e8760f9df>Automate iOS devices — The (almost) Mac free way</a></p><p><a href=https://www.cnblogs.com/chen-xia/articles/14268025.html>ideviceinstaller安装</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$brew uninstall ideviceinstaller
</span></span><span style=display:flex><span>$brew uninstall libimobiledevice
</span></span><span style=display:flex><span>$brew install --HEAD libimobiledevice
</span></span><span style=display:flex><span>$brew link --overwrite libimobiledevice
</span></span><span style=display:flex><span>$brew install ideviceinstaller
</span></span><span style=display:flex><span>$brew link --overwrite ideviceinstaller
</span></span></code></pre></div><h3 id=appium-webdriveragent-项目构建>appium-webdriveragent 项目构建</h3><p>当前使用的版本<a href="https://github.com/appium/WebDriverAgent/tags?after=v4.0.0">v3.16.0</a>，下载zip源码后，nodejs项目，执行<code>node ./Scripts/build-webdriveragent.js</code>——需要确保依赖的npm包已经安装，可先执行<code>npm install</code>，即使整体任务失败也没关系，打包wda的依赖安装成功即可。</p><p>业务逻辑：</p><ul><li>获取xcode版本</li><li>删除用户目录下的DerivedData中wda相关的(缓存WDA)编译结果 <code>~/Library/Developer/Xcode/DerivedData/WebDriverAgent-*</code></li><li>执行wda编译脚本，默认针对的模拟器构建 <code>/bin/bash ./Scripts/build.sh</code>，传递的参数 runner，sim</li><li>创建 <code>uncompressed</code> 和 <code>bundles</code>目录，</li><li>将xcode项目文件复制到此目录下，</li><li>并将编译生成的 <code>WebDriverAgent-*</code> 文件保存当前目录的<code>DerivedData/WebDriverAgent</code></li><li>将此目录整体打包为 webdriveragent-xcode_xcodeversion.zip 文件，并保存中 bundles 目录下</li><li>将编译打包的<code>DerivedData/WebDriverAgent/Build/Products/Debug-iphonesimulator/WebDriverAgentRunner-Runner.app</code>压缩为zip文件 <code>WebDriverAgentRunner-Runner.app.zip</code>保存在工程主目录</li><li>删除uncopressed目录</li></ul><h2 id=环境搭建>环境搭建</h2><ul><li>完整版环境搭建 <a href=https://krishnachetan.medium.com/setup-appium-on-mac-1e06f1178427>Setup Appium on Mac OS for Android and iOS App Automation [2022 Update]</a></li><li>简单说明版本<a href=https://shivamtiwari2996.medium.com/install-appium-on-mac-os-for-ios-and-setup-19b2442a188>Install Appium on Mac OS for iOS and setup</a></li><li><a href=https://appium.io/docs/en/about-appium/api/>Appium API</a></li></ul><p>使用现有的环境，还没有按照上面的文档进行搭建操作。</p><p>简单理解：appium作为web server，实现了JSONWP协议。这样客户端可以语言无关，调用符合规范的http接口即可。后端对接不同的实现，支持不同的平台，例如android、iOS、windows、Web等等。</p><h3 id=多版本支持>多版本支持</h3><p><a href=https://discuss.appium.io/t/how-to-install-multiple-appium-versions-on-my-mac/33085>How to install multiple appium versions on my Mac</a></p><p>本质上，appium是一个<a href=https://appium.io/docs/en/contributing-to-appium/developers-overview/>nodejs版本的web server</a>，安装好依赖环境之后，只需要将appium安装到不同的目录即可——</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e>#Install version 1.22.2</span>
</span></span><span style=display:flex><span>npm install --prefix /opt/appium1.22.2 appium@1.22.2
</span></span><span style=display:flex><span><span style=color:#75715e>#Install version 1.22.3</span>
</span></span><span style=display:flex><span>npm install --prefix /opt/appium1.22.3 appium@1.22.3
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Start the version 1.22.2</span>
</span></span><span style=display:flex><span>cd /opt/appium1.20.1
</span></span><span style=display:flex><span>./node_modules/appium/build/lib/main.js --version
</span></span><span style=display:flex><span>1.22.2
</span></span><span style=display:flex><span>% ./node_modules/appium/build/lib/main.js
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Appium<span style=color:#f92672>]</span> Welcome to Appium v1.22.2
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Appium<span style=color:#f92672>]</span> Appium REST http interface listener started on 0.0.0.0:4723
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Start the version 1.22.3</span>
</span></span><span style=display:flex><span>cd /opt/appium1.22.3
</span></span><span style=display:flex><span>./node_modules/appium/build/lib/main.js --version
</span></span><span style=display:flex><span>1.22.3
</span></span><span style=display:flex><span>./node_modules/appium/build/lib/main.js -p <span style=color:#ae81ff>4724</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Appium<span style=color:#f92672>]</span> Welcome to Appium v1.22.3
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Appium<span style=color:#f92672>]</span> Non-default server args:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Appium<span style=color:#f92672>]</span> port: <span style=color:#ae81ff>4724</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Appium<span style=color:#f92672>]</span> Appium REST http interface listener started on 0.0.0.0:4724
</span></span></code></pre></div><h3 id=指定appium使用的xcode版本>指定appium使用的Xcode版本</h3><p><a href=https://github.com/appium/appium-xcuitest-driver/blob/master/docs/multiple-xcode-versions.md>Running Appium with multiple Xcode versions installed</a></p><p>如果有多个Xcode版本——</p><ul><li>使用 <code>xcode-select</code> 工具</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># show current default Xcode</span>
</span></span><span style=display:flex><span>xcode-select --print-path
</span></span><span style=display:flex><span><span style=color:#75715e># Set default Xcode.</span>
</span></span><span style=display:flex><span>sudo xcode-select -s /Applications/Xcode13.app/Contents/Developer
</span></span><span style=display:flex><span><span style=color:#75715e># Run Appium (from command line or with GUI).</span>
</span></span><span style=display:flex><span>appium
</span></span></code></pre></div><ul><li>使用环境变量</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e>#Set DEVELOPER_DIR environment variable.</span>
</span></span><span style=display:flex><span>export DEVELOPER_DIR<span style=color:#f92672>=</span>/Applications/Xcode12.app/Contents/Developer
</span></span><span style=display:flex><span><span style=color:#75715e>#Run Appium from the same shell.</span>
</span></span><span style=display:flex><span>appium 
</span></span></code></pre></div><h3 id=node环境>node环境</h3><p>Mac： 下载pkg文件，命令行安装 <code>sudo installer -pkg /path/to/you_pkg_file.pkg -target /</code></p><h3 id=install-dmg>install dmg</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 命令行下安装 dmg</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 1. 挂在 dmg</span>
</span></span><span style=display:flex><span>sudo hdiutil attach &lt;image&gt;.dmg
</span></span><span style=display:flex><span><span style=color:#75715e># 2. 安装 pkg -target 参数指就是 / </span>
</span></span><span style=display:flex><span>sudo installer -pkg /Volumes/&lt;image&gt;/&lt;image&gt;.pkg -target /
</span></span><span style=display:flex><span><span style=color:#75715e># 3. 卸载 dmg</span>
</span></span><span style=display:flex><span>sudo hdituil detach &lt;image&gt;.dmg
</span></span></code></pre></div><h3 id=permission-denial>Permission denial</h3><p>各个手机设置不同——</p><ul><li>小米：在开发者选项里，把“USB调试（安全设置）&ldquo;打开即可，允许USB调试修改权限或模拟点击</li><li>oppo/一加：在开发者选项里，把"禁止权限监控"打开（在“应用”部分，最下面）</li></ul><pre tabindex=0><code>[UiAutomator2] Relaxing hidden api policy
[debug] [ADB] Running &#39;/Users/geb/Library/Android/sdk/platform-tools/adb -P 5037 -s 18a281e9 shell &#39;settings put global hidden_api_policy_pre_p_apps 1;settings put global hidden_api_policy_p_apps 1;settings put global hidden_api_policy 1&#39;&#39;
[debug] [UiAutomator2] Deleting UiAutomator2 session
[debug] [ADB] Running &#39;/Users/geb/Library/Android/sdk/platform-tools/adb -P 5037 -s 18a281e9 shell am force-stop com.coloros.calculator&#39;
[UiAutomator2] Restoring hidden api policy to the device default configuration
[debug] [ADB] Running &#39;/Users/geb/Library/Android/sdk/platform-tools/adb -P 5037 -s 18a281e9 shell &#39;settings delete global hidden_api_policy_pre_p_apps;settings delete global hidden_api_policy_p_apps;settings delete global hidden_api_policy&#39;&#39;
[debug] [BaseDriver] Event &#39;newSessionStarted&#39; logged at 1665558963920 (15:16:03 GMT+0800 (China Standard Time))
[debug] [W3C] Encountered internal error running command: Error executing adbExec. Original error: &#39;Command &#39;/Users/geb/Library/Android/sdk/platform-tools/adb -P 5037 -s 18a281e9 shell &#39;settings delete global hidden_api_policy_pre_p_apps;settings delete global hidden_api_policy_p_apps;settings delete global hidden_api_policy&#39;&#39; exited with code 255&#39;; Command output: 
[debug] [W3C] Exception occurred while executing &#39;delete&#39;:
[debug] [W3C] java.lang.SecurityException: Permission denial: writing to settings requires:android.permission.WRITE_SECURE_SETTINGS
[debug] [W3C] 	at com.android.providers.settings.SettingsProvider.enforceWritePermission(SettingsProvider.java:2640)
[debug] [W3C] 	at com.android.providers.settings.SettingsProvider.mutateGlobalSetting(SettingsProvider.java:1632)
[debug] [W3C] 	at com.android.providers.settings.SettingsProvider.mutateGlobalSetting(SettingsProvider.java:1624)
[debug] [W3C] 	at com.android.providers.settings.SettingsProvider.deleteGlobalSetting(SettingsProvider.java:1595)
[debug] [W3C] 	at com.android.providers.settings.SettingsProvider.call(SettingsProvider.java:661)
[debug] [W3C] 	at android.content.ContentProvider.call(ContentProvider.java:2473)
[debug] [W3C] 	at android.content.ContentProvider$Transport.call(ContentProvider.java:521)
[debug] [W3C] 	at com.android.providers.settings.SettingsService$MyShellCommand.deleteForUser(SettingsService.java:408)
[debug] [W3C] 	at com.android.providers.settings.SettingsService$MyShellCommand.onCommand(SettingsService.java:282)
[debug] [W3C] 	at com.android.modules.utils.BasicShellCommandHandler.exec(BasicShellCommandHandler.java:97)
[debug] [W3C] 	at android.os.ShellCommand.exec(ShellCommand.java:38)
[debug] [W3C] 	at com.android.providers.settings.SettingsService.onShellCommand(SettingsService.java:50)
[debug] [W3C] 	at android.os.Binder.shellCommand(Binder.java:970)
[debug] [W3C] 	at android.os.Binder.onTransact(Binder.java:854)
[debug] [W3C] 	at android.os.Binder.execTransactInternal(Binder.java:1226)
[debug] [W3C] 	at android.os.Binder.execTransact(Binder.java:1163)
</code></pre><h3 id=安装libimobiledevice-最新版本>安装libimobiledevice 最新版本</h3><p>目前brew上的最新版本为1.3.0，但不支持iOS 16.0。使用 <code>brew install --HEAD libimobiledevice</code>时，提示缺少libimobiledevice-glue-1.0</p><p>参考<a href=https://github.com/libimobiledevice/libimobiledevice/issues/1217#issuecomment-1009402345>issue 1217下的comment</a>，手动创建blue的formula</p><ul><li>brew手动安装<code>libimobiledevice-glue</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e>#手动创建formula</span>
</span></span><span style=display:flex><span>brew create <span style=color:#e6db74>&#34;https://github.com/libimobiledevice/libimobiledevice-glue.git&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#自动进入编辑模式，或手动进入，按照下面的格式编辑</span>
</span></span><span style=display:flex><span>brew edit libimobiledevice-glue
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 执行安装</span>
</span></span><span style=display:flex><span>brew install --HEAD libimobiledevice-glue
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LibimobiledeviceGlue</span> <span style=color:#f92672>&lt;</span> <span style=color:#66d9ef>Formula</span>
</span></span><span style=display:flex><span>   desc <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>   homepage <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>   license <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>   head <span style=color:#e6db74>&#34;https://github.com/libimobiledevice/libimobiledevice-glue.git&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   depends_on <span style=color:#e6db74>&#34;autoconf&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>:build</span>
</span></span><span style=display:flex><span>   depends_on <span style=color:#e6db74>&#34;automake&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>:build</span>
</span></span><span style=display:flex><span>   depends_on <span style=color:#e6db74>&#34;libtool&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>:build</span>
</span></span><span style=display:flex><span>   depends_on <span style=color:#e6db74>&#34;pkg-config&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>:build</span>
</span></span><span style=display:flex><span>   depends_on <span style=color:#e6db74>&#34;libplist&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>install</span>
</span></span><span style=display:flex><span>     system <span style=color:#e6db74>&#34;./autogen.sh&#34;</span>, <span style=color:#e6db74>&#34;--prefix=</span><span style=color:#e6db74>#{</span>prefix<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>     system <span style=color:#e6db74>&#34;make&#34;</span>, <span style=color:#e6db74>&#34;install&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>end</span>
</span></span></code></pre></div><ul><li>修改libimobiledevice的formula之后安装HEAD</li></ul><p><code>brew edit libimobiledevice</code>修改formula，增加 <code>depends_on "libimobiledevice-glue"</code>，然后执行 <code>brew install --HEAD libimobiledevice</code></p><h3 id=手动搬运mac环境下的appium>手动搬运Mac环境下的appium</h3><p>目标机器网络环境不佳，另外一台机器上有appium 1.22.3版本的环境。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 打包appium， 目录 /usr/local/lib/node_modules</span>
</span></span><span style=display:flex><span>tar -czvf appium.tar.gz appium
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 解压到目标机器对应相同目录 /usr/local/lib/node_modules</span>
</span></span><span style=display:flex><span>tar -zxvf appium.tar.gz -C ./
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># jar 命令有类似的功能，但不能指定解压目录， 将以下war包解压到当前目录</span>
</span></span><span style=display:flex><span>jar -xvf test.war 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 创建软连接启动项目 目录   /usr/local/bin </span>
</span></span><span style=display:flex><span>ln -s ../lib/node_modules/appium/build/lib/main.js appium 
</span></span><span style=display:flex><span><span style=color:#75715e># 这里的坑是：记得前面是源地址，后面的是目标地址。 将后面的软连接连接到源地址上。一开始整错了，没修改；又重新连接了一回，结果就循环了 </span>
</span></span><span style=display:flex><span><span style=color:#75715e># 检查方式：https://www.baeldung.com/linux/too-many-levels-of-symlinks</span>
</span></span><span style=display:flex><span>find -L appium  <span style=color:#75715e># Mac 下提示 find: Symlink loop resolving appium</span>
</span></span><span style=display:flex><span>file appium 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 检查appium版本</span>
</span></span><span style=display:flex><span>appium -v 
</span></span></code></pre></div><h3 id=脚本编写>脚本编写</h3><ul><li><a href=https://appium.io/docs/en/commands/element/find-element/>Find Element</a></li><li>安装对应的client端，例如 <code>pip install Appium-Python-Client</code>，</li><li>安装pytest框架 <code>pip install pytest</code></li><li>使用appium inspector进行录制，转换为对应的脚本，再做对应的修改</li><li>执行<code>pytest</code>，详情<a href=https://docs.pytest.org/en/7.1.x/getting-started.html>参考</a></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># This sample code uses the Appium python client</span>
</span></span><span style=display:flex><span><span style=color:#75715e># pip install Appium-Python-Client</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Then you can paste this into a file and simply run with Python</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> time <span style=color:#f92672>import</span> sleep
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> appium <span style=color:#f92672>import</span> webdriver
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> selenium.webdriver.common.by <span style=color:#f92672>import</span> By
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TestIOS</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>setup</span>(self):
</span></span><span style=display:flex><span>        <span style=color:#75715e># https://appium.io/docs/en/drivers/ios-xcuitest/index.html </span>
</span></span><span style=display:flex><span>        caps <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>        caps[<span style=color:#e6db74>&#34;platformName&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ios&#34;</span>
</span></span><span style=display:flex><span>        caps[<span style=color:#e6db74>&#34;platformVersion&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;16.1&#34;</span>
</span></span><span style=display:flex><span>        caps[<span style=color:#e6db74>&#34;automationName&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;xcuitest&#34;</span>
</span></span><span style=display:flex><span>        caps[<span style=color:#e6db74>&#34;bundleId&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;com.ecpmobile.ecp&#34;</span>
</span></span><span style=display:flex><span>        caps[<span style=color:#e6db74>&#34;deviceName&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;xx的 iPhone&#34;</span>
</span></span><span style=display:flex><span>        caps[<span style=color:#e6db74>&#34;udid&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;d6afe671ffcf3efdadb686f296a29cb4a7452aea&#34;</span>
</span></span><span style=display:flex><span>        caps[<span style=color:#e6db74>&#34;xcodeOrgId&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;2Z7MNS5L34&#34;</span>
</span></span><span style=display:flex><span>        caps[<span style=color:#e6db74>&#34;xcodeSigningId&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;iPhone Developer&#34;</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>driver <span style=color:#f92672>=</span> webdriver<span style=color:#f92672>.</span>Remote(<span style=color:#e6db74>&#34;http://127.0.0.1:4723/wd/hub&#34;</span>, caps)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>test_real_buttons</span>(self):
</span></span><span style=display:flex><span>        el3 <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>driver<span style=color:#f92672>.</span>find_element(By<span style=color:#f92672>.</span>ID, <span style=color:#e6db74>&#34;login aboutus&#34;</span>)
</span></span><span style=display:flex><span>        el3<span style=color:#f92672>.</span>click()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        el2 <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>driver<span style=color:#f92672>.</span>find_element(By<span style=color:#f92672>.</span>ID, <span style=color:#e6db74>&#34;更多信息&#34;</span>)
</span></span><span style=display:flex><span>        el2<span style=color:#f92672>.</span>click()
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>driver<span style=color:#f92672>.</span>back()
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>driver<span style=color:#f92672>.</span>back()
</span></span><span style=display:flex><span>        el5 <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>driver<span style=color:#f92672>.</span>find_element(By<span style=color:#f92672>.</span>XPATH, <span style=color:#e6db74>&#34;//XCUIElementTypeStaticText[@name=</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>忘记密码？</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>]&#34;</span>)
</span></span><span style=display:flex><span>        el5<span style=color:#f92672>.</span>click()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        directory <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>/&#39;</span> <span style=color:#f92672>%</span> os<span style=color:#f92672>.</span>getcwd()
</span></span><span style=display:flex><span>        fn <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;screenshot.png&#39;</span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>driver<span style=color:#f92672>.</span>get_screenshot_as_file(directory<span style=color:#f92672>+</span>fn)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>teardown</span>(self):
</span></span><span style=display:flex><span>        sleep(<span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>driver<span style=color:#f92672>.</span>quit()
</span></span></code></pre></div><p>脚本保存到 testappium文件夹下，命名为<code>test.py</code></p><h3 id=命令行方式执行>命令行方式执行</h3><p>独立命令行启动appium <code>appium -g /tmp/appium.log</code> 确保使用 node版本为v16.17.1的长期版本，否则appium可能提示<code>failed to receive to receive any data within the timeout 5000</code> ，参考官方的<a href=https://github.com/appium/appium/issues/16399>issue 16399</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 创建虚拟环境</span>
</span></span><span style=display:flex><span>python3 -m venv testappium
</span></span><span style=display:flex><span><span style=color:#75715e># 激活当前环境</span>
</span></span><span style=display:flex><span>source testappium/bin/activate 
</span></span><span style=display:flex><span><span style=color:#75715e># 安装依赖</span>
</span></span><span style=display:flex><span>pip3 install pytest
</span></span><span style=display:flex><span>pip3 install Appium-Python-Client
</span></span><span style=display:flex><span><span style=color:#75715e># 执行测试，确保已经有appium server启动</span>
</span></span><span style=display:flex><span>pytest test.py
</span></span></code></pre></div><h3 id=打包wda>打包WDA</h3><ul><li>下载项目，使用xcode打开</li><li>WDA签名使用导入的方式，不勾选 &ldquo;Automatically manage signing&rdquo;，使用import方式<ul><li>Targets中的 <code>WebDriverAgentRunner</code>必须导入签名， <code>WebDriverAgentLib</code>可以不添加证书</li></ul></li><li>根据provisiioning profile文件中的AppId修改项目的<code>bundle identifier</code></li><li>选择Product菜单栏对应的Destination和Scheme，分别设置为连接的iPhone设备和 WebDriverAgentRunner</li><li>执行 Product菜单栏的 Test</li></ul><p>将自动打包安装WDA到对应的手机。详细的操作可以<a href=https://blog.csdn.net/weixin_41765699/article/details/124322812>参考</a>，或者<a href=https://testerhome.com/topics/7220>这里</a></p><p>也可以采用 xcodebuild 命令行模式执行——</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># 解锁keychain，以便可以正常的签名应用，PASSWORD是你自己mac电脑的开机密码</span>
</span></span><span style=display:flex><span>PASSWORD<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;你自己的开机密码&#34;</span> 
</span></span><span style=display:flex><span>security unlock-keychain -p $PASSWORD ~/Library/Keychains/login.keychain
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 获取设备的UDID</span>
</span></span><span style=display:flex><span>UDID<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>idevice_id -l | head -n1<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>xcodebuild -project WebDriverAgent.xcodeproj -scheme WebDriverAgentRunner -destination <span style=color:#e6db74>&#34;id=</span>$UDID<span style=color:#e6db74>&#34;</span> USE_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>8100</span> test 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># with </span>
</span></span></code></pre></div><h4 id=xcode提示codesign-想要访问您的钥匙串中的密钥>Xcode提示“codesign 想要访问您的钥匙串中的密钥”</h4><p>在 Keychain Access中选择 login.keychain中的登录选项中导入的证书，双击私钥，修改“访问控制 access controll”，选择 所有应用都可以访问。更精细的可以将 codesign应用添加到列表中（没找到如何选中 <code>/usr/bin/codesign</code>的方法）。 <a href=https://www.jianshu.com/p/4a58d4967b1f>图文参考</a></p><h4 id=安装wda时报错-the-code-signature-version-is-no-longer-supported>安装WDA时报错 “The code signature version is no longer supported”</h4><p>在iOS 15以上版本安装WDA时提示报错。因为“Apple has changed the codesign signature to include DER (Distinguished Encoding Rules) encoded entitlements in addition to the plist encoded entitlements. ” 采用了新的编码规范，低版本Xcode默认不支持，需要进行设置。<a href=https://stackoverflow.com/a/68467307/1087122>参考</a></p><ul><li>Xcode: <code>Build Setting -> Other Code Signing Flags</code> 添加 <code>--generate-entitlement-der</code></li><li>xcodebuild: <code>xcodebuild OTHER_CODE_SIGN_FLAGS='--generate-entitlement-der' -project WebDriverAgent.xcodeproj -scheme WebDriverAgentRunner -destination "id=$UDID" USE_PORT=8100 test</code></li></ul><p>更直接的办法是升级Xcode版本:)</p><h4 id=xcode-140打包wda报错>Xcode 14.0打包WDA报错</h4><p>遇到链接问题: ld: cannot link directly with dylib/framework, your binary is not an allowed client of /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/Library/PrivateFrameworks/XCTAutomationSupport.framework/XCTAutomationSupport for architecture arm64</p><p>官方论坛<a href=https://developer.apple.com/forums/thread/712039>相关问题</a>，appium的github描述了<a href=https://github.com/appium/appium/issues/17174>原因</a>：苹果官方更严格的限制，导致XCTAutomationSupport问题，在appium2中修复了这个问题。Fastbot也出现类似的<a href=https://github.com/bytedance/Fastbot_iOS/issues/103>问题</a>，建议使用低版本的进行代替——实操可行。</p><p>替换之后，遇到的问题时之前截图的命令现在提示——</p><pre tabindex=0><code> Encountered internal error running command: UnableToCaptureScreen: Error Domain=XCTDaemonErrorDomain Code=39 &#34;Legacy screen requests are no longer supported&#34; UserInfo={NSLocalizedDescription=Legacy screen requests are no longer supported}
[debug] [W3C (4754dddc)]     at errorFromW3CJsonCode (/usr/local/lib/node_modules/appium/node_modules/appium-base-driver/lib/protocol/errors.js:780:25)
[debug] [W3C (4754dddc)]     at ProxyRequestError.getActualError (/usr/local/lib/node_modules/appium/node_modules/appium-base-driver/lib/protocol/errors.js:663:14)
[debug] [W3C (4754dddc)]     at JWProxy.command (/usr/local/lib/node_modules/appium/node_modules/appium-base-driver/lib/jsonwp-proxy/proxy.js:272:19)
[debug] [W3C (4754dddc)]     at runMicrotasks (&lt;anonymous&gt;)
[debug] [W3C (4754dddc)]     at processTicksAndRejections (node:internal/process/task_queues:96:5)
[debug] [W3C (4754dddc)]     at XCUITestDriver.proxyCommand (/usr/local/lib/node_modules/appium/node_modules/appium-xcuitest-driver/lib/commands/proxy-helper.js:96:12)
[debug] [W3C (4754dddc)]     at getScreenshotFromWDA (/usr/local/lib/node_modules/appium/node_modules/appium-xcuitest-driver/lib/commands/screenshots.js:11:18)
[debug] [W3C (4754dddc)]     at wrapped (/usr/local/lib/node_modules/appium/node_modules/asyncbox/lib/asyncbox.js:60:13)
[debug] [W3C (4754dddc)]     at retry (/usr/local/lib/node_modules/appium/node_modules/asyncbox/lib/asyncbox.js:43:13)
[debug] [W3C (4754dddc)]     at retryInterval (/usr/local/lib/node_modules/appium/node_modules/asyncbox/lib/asyncbox.js:70:10)
[debug] [W3C (4754dddc)]     at XCUITestDriver.getScreenshot (/usr/local/lib/node_modules/appium/node_modules/appium-xcuitest-driver/lib/commands/screenshots.js:42:10)
</code></pre><h3 id=现状总结>现状总结</h3><p>使用appium 1.22.3版本，打包自带的WDA工程(位于 <code>/usr/local/lib/node_modules/appium/node_modules/appium-webdriveragent</code>)，然后写自动化脚本进行验证</p><ul><li>Mac 12.6 + Xcode 13.4.1 + Appium 1.22.3 可以正常支持 iOS 16.0 版本，操作、截图正常</li><li>Mac 13.0 + Xcode 14.0 + Appium 1.22.3 由于Xcode中的XCTAutomationSupport问题导致无法正常编译；使用Xcode 13.4版本的XCTAutomationSupport替换之后，正常点击操作OK，但截图提示错误</li></ul><p>重新离线下载Xcode 13.4.1，但无法安装到Mac13.0 Ventura系统，<a href=https://developer.apple.com/forums/thread/707626>官方描述</a>，即使使用命令行启动，依然会报错——</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>utfdeMini-148:~  /Applications/Xcode13.4.1.app/Contents/MacOS/Xcode 
</span></span><span style=display:flex><span>Killed: <span style=color:#ae81ff>9</span>
</span></span><span style=display:flex><span>utfdeMini-148:~ utf$ The application cannot be opened <span style=color:#66d9ef>for</span> an unexpected reason, error<span style=color:#f92672>=</span>Error Domain<span style=color:#f92672>=</span>NSOSStatusErrorDomain Code<span style=color:#f92672>=</span>-10664 <span style=color:#e6db74>&#34;kLSIncompatibleApplicationVersionErr: The app is incompatible with the current OS&#34;</span> UserInfo<span style=color:#f92672>={</span>_LSLine<span style=color:#f92672>=</span>4047, _LSFunction<span style=color:#f92672>=</span>_LSOpenStuffCallLocal<span style=color:#f92672>}</span>
</span></span></code></pre></div><p><a href=https://support.macincloud.com/support/solutions/articles/8000042681-how-to-utilize-a-different-xcode-version-for-build-process-on-mac>Utilize a Different Xcode Version for Build Process </a>这里的方式……好像多尝试几次之后居然成功了？</p><p>需要先设置变量</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>export DEVELOPER_DIR<span style=color:#f92672>=</span>/Applications/Xcode13.4.1.app/Contents/Developer <span style=color:#75715e># make sure set this value first， or else the Xcode cann&#39;t open. </span>
</span></span><span style=display:flex><span>/Applications/Xcode13.4.1.app/Contents/MacOS/Xcode
</span></span></code></pre></div><p>效果验证</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># example</span>
</span></span><span style=display:flex><span>utfdeMini-148:~ utf$ export DEVELOPER_DIR<span style=color:#f92672>=</span>/Applications/Xcode13.4.1.app/Contents/Developer
</span></span><span style=display:flex><span>utfdeMini-148:~ utf$ /Applications/Xcode13.4.1.app/Contents/MacOS/Xcode 
</span></span><span style=display:flex><span>objc<span style=color:#f92672>[</span>38398<span style=color:#f92672>]</span>: Class ASVError is implemented in both /Applications/Xcode13.4.1.app/Contents/SharedFrameworks/GPUToolsCore.framework/Versions/A/GPUToolsCore <span style=color:#f92672>(</span>0x12c851050<span style=color:#f92672>)</span> and /Applications/Xcode13.4.1.app/Contents/PlugIns/GPUDebugger.ideplugin/Contents/Frameworks/GPUToolsASVC.framework/Versions/A/GPUToolsASVC <span style=color:#f92672>(</span>0x125c30338<span style=color:#f92672>)</span>. One of the two will be used. Which one is undefined.
</span></span><span style=display:flex><span>objc<span style=color:#f92672>[</span>38398<span style=color:#f92672>]</span>: Class DYShaderAnalyzerNextGPU is implemented in both /Applications/Xcode13.4.1.app/Contents/SharedFrameworks/MTLToolsShaderProfiler.framework/Versions/A/MTLToolsShaderProfiler <span style=color:#f92672>(</span>0x12cc7ac60<span style=color:#f92672>)</span> and /Applications/Xcode13.4.1.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/Library/GPUTools/PlugIns/GLToolsShaderProfilerMobileSupport.gtplugin/Contents/MacOS/GLToolsShaderProfilerMobileSupport <span style=color:#f92672>(</span>0x12ce2a9c0<span style=color:#f92672>)</span>. One of the two will be used. Which one is undefined.
</span></span><span style=display:flex><span>2022-09-29 17:36:29.376 Xcode<span style=color:#f92672>[</span>38398:1616211<span style=color:#f92672>]</span> Looking <span style=color:#66d9ef>for</span> Simulator.app in <span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&lt;DVTFilePath:0x60000294bf00:&#39;/Applications/Xcode13.4.1.app/Contents/Developer/Applications&#39;&gt;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>2022-09-29 17:36:33.295 Xcode<span style=color:#f92672>[</span>38398:1617460<span style=color:#f92672>]</span>  DVTPortal: Service <span style=color:#e6db74>&#39;&lt;DVTPortalViewDeveloperService: 0x600001a018c0; action=&#39;</span>viewDeveloper<span style=color:#e6db74>&#39;&gt;&#39;</span> encountered an unexpected result code from the portal <span style=color:#f92672>(</span><span style=color:#e6db74>&#39;1100&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>2022-09-29 17:36:33.295 Xcode<span style=color:#f92672>[</span>38398:1617460<span style=color:#f92672>]</span>  DVTPortal: Error:
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>执行<code>sudo xcode-select --switch /Applications/Xcode13.4.1.app</code>强制切换后(图标已经显示为禁止操作)。重新执行成功了(尽管命令行启动时会有报错信息)</p><div class="prev-next-post pure-g"><div class=pure-u-1-24 style=text-align:left><a href=http://gebitang.com/post/what/runny-nose/><i class="fa fa-chevron-left"></i></a></div><div class=pure-u-10-24><nav class=prev><a href=http://gebitang.com/post/what/runny-nose/>那些年流过的鼻涕</a></nav></div><div class=pure-u-2-24>&nbsp;</div><div class=pure-u-10-24></div><div class=pure-u-1-24 style=text-align:right></div></div><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="gebitang",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=http://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div><script src=http://gebitang.com/js/ui.js></script><script src=http://gebitang.com/js/menus.js></script><script>window.location.hostname!="localhost"&&(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-34303694-1","auto"),ga("send","pageview"))</script><button onclick=topFunction() id=myBtn title="Go to top">Top</button></body></html>