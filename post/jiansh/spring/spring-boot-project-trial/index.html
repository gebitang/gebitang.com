<!doctype html><html xmlns:wb=http://open.weibo.com/wb lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=generator content="Hugo 0.96.0"><title>Spring-boot-project-trial &#183; 戈壁堂</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css><!--[if lte IE 8]><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css><!--<![endif]--><!--[if lte IE 8]><link rel=stylesheet href=http://gebitang.com/css/side-menu-old-ie.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=http://gebitang.com/css/side-menu.css><!--<![endif]--><link rel=stylesheet href=http://gebitang.com/css/blackburn.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.9.0/css/all.css><link href="https://fonts.googleapis.com/css?family=Raleway" rel=stylesheet type=text/css><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js></script>
<script>hljs.initHighlightingOnLoad()</script><link rel="shortcut icon" href=http://gebitang.com/img/favicon.ico type=image/x-icon><link rel=stylesheet href=http://gebitang.com/css/my.css><script src=http://gebitang.com/js/my.js></script></head><body><div id=layout><a href=#menu id=menuLink class=menu-link><span></span></a><div id=menu><a class="pure-menu-heading brand" href=http://gebitang.com/>Gebitang</a><div class=pure-menu><ul class=pure-menu-list><li class=pure-menu-item><a class=pure-menu-link href=http://gebitang.com/><i class="fa fa-home fa-fw"></i>Home</a></li><li class=pure-menu-item><a class=pure-menu-link href=http://gebitang.com/post/><i class="fa fa-list fa-fw"></i>Posts</a></li><li class=pure-menu-item><a class=pure-menu-link href=http://gebitang.com/about/><i class="fa fa-user fa-fw"></i>About</a></li><li class=pure-menu-item><a class=pure-menu-link href=http://gebitang.com/contact/><i class="fa fa-phone fa-fw"></i>Contact</a></li><li class=pure-menu-item><a class=pure-menu-link href=http://gebitang.com/tags/><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class=pure-menu-item><a class=pure-menu-link href=http://gebitang.com/topics/><i class="fa fa-folder fa-fw"></i>Topics</a></li></ul></div><div class="pure-menu social"><ul class=pure-menu-list></ul></div><div><div class=small-print><small><a rel=license href=http://creativecommons.org/licenses/by/4.0/><img alt=知识共享许可协议 style=border-width:0 src=https://i.creativecommons.org/l/by/4.0/80x15.png></a><br>本<span xmlns:dct=http://purl.org/dc/terms/ href=http://purl.org/dc/dcmitype/Text rel=dct:type>作品</span>由<a xmlns:cc=http://creativecommons.org/ns# href=http://gebitang.com property="cc:attributionName" rel=cc:attributionurl>&nbsp;Gebitang&nbsp;&nbsp;</a>采用<a rel=license href=http://creativecommons.org/licenses/by/4.0/>知识共享署名 4.0 国际许可协议</a>进行许可&nbsp;&copy; 2018</small></div><div class=small-print><small></small></div><div class=small-print><small>Built with&nbsp;<a href=https://gohugo.io/ target=_blank>Hugo</a></small>
<small>Theme&nbsp;<a href=https://github.com/yoshiharuyamashita/blackburn target=_blank>Blackburn</a></small></div><div style=display:none><div class=small-print><small><wb:follow-button uid=2446212465 type=red_1 width=67 height=24></wb:follow-button></small></div></div></div></div><div id=main><div class=header><h1>Spring-boot-project-trial</h1><h2></h2></div><div class=content><div class=post-meta><div><i class="fa fa-calendar fa-fw"></i>
<time>2021-03-07</time></div><div><i class="fa fa-folder fa-fw"></i>
<a class=post-taxonomy-topic href=http://gebitang.com/topics/jiansh>jiansh</a>&nbsp;/
<a class=post-taxonomy-topic href=http://gebitang.com/topics/spring>Spring</a></div><div><i class="fa fa-tags fa-fw"></i>
<a class=post-taxonomy-tag href=http://gebitang.com/tags/jiansh>jiansh</a></div></div><nav id=TableOfContents></nav><p>涉及到的问题：</p><ol><li><p>Spring boot工程基础
使用bootcase工程完成练习。</p></li><li><p>yaml文件类型的配置使用，可参考<a href=https://www.baeldung.com/spring-yaml>spring yaml</a>
默认位置为<code>/myApplication/src/main/resources/application.yml</code> 支持多环境配置</p></li><li><p>使用druid管理数据库连接
参考<a href=https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter>官方文档</a>
使用依赖工程里的pom依赖。配置优化为了yml文件格式</p></li></ol><pre tabindex=0><code>&lt;dependency&gt;
   &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
   &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt;
   &lt;version&gt;1.1.17&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><ol start=4><li>kafka配置以及基本使用
consumer & producer在两个不同的工程下。
使用yml文件指定对应的 property文件名称，</li></ol><pre tabindex=0><code>kafka:
  topic: q_test_topic
  consumer:
    properties-file: kafka-consumer-test.properties
</code></pre><p>读取property文件构造对象</p><pre tabindex=0><code>ClassPathResource resource = new ClassPathResource(kafkaPropFile);
// utils来自spring boot --&gt; spring core
Properties onlineConsumerProperties = PropertiesLoaderUtils.loadProperties(resource);
KafkaConsumer kafkaConsumer = new KafkaConsumer(onlineConsumerProperties);
</code></pre><ol start=5><li>redis配置使用
Redis官方提供的Redis client部分Java端的包括Jedis和Lettuce。springboot 2.x版本中默认客户端是用lettuce实现。</li></ol><p>Jedis</p><blockquote><p>使用阻塞的I/O，且其方法调用都是同步的，程序流需要等到sockets处理完I/O才能执行，不支持异步。Jedis客户端实例不是线程安全的，所以需要通过连接池来使用Jedis。</p></blockquote><p>Lettuce</p><blockquote><p>高级Redis客户端，用于线程安全同步，异步和响应使用，支持集群，Sentinel，管道和编码器。基于Netty框架的事件驱动的通信层，其方法调用是异步的。Lettuce的API是线程安全的，所以可以操作单个Lettuce连接来完成各种操作</p></blockquote><pre tabindex=0><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><p>默认情况下的模板只能支持 RedisTemplate&lt;String,String>，只能存入字符串。目前工程使用的<code>StringRedisTemplate</code>正式默认支持的模板，所以只需要提供默认配置即可——</p><pre tabindex=0><code>spring:
  redis:
    # Redis服务器地址
    host: redis.dns.fxxk.com
    # 端口号   
    port: 10037
    # Redis数据库索引，默认为0
    database: 0
    # Redis服务器连接密码（默认为空）
    password:
    # 连接超时时间（毫秒）
    timeout: 1000
    poll:
      # 连接池最大连接数（使用负值表示没有限制）
      max-active: 8
      # 连接池最大阻塞等待时间（使用负值表示没有限制）
      max-wait: -1
      # 连接池最大空闲连接
      max-idle: 8
      # 连接池最小空闲连接
      min-idle: 0
</code></pre><p>指定了cluster的方式——</p><pre tabindex=0><code>spring:
  redis:
    timeout: 6000ms
    database: 0
    cluster:
      nodes:
        - 10.16.9.191:4567
        - 10.16.9.192:4567
        - 10.16.9.193:4567
      max-redirects: 3 # 获取失败 最大重定向次数
    lettuce:
      pool:
        max-active: 1000  #连接池最大连接数（使用负值表示没有限制）
        max-idle: 10 # 连接池中的最大空闲连接
        min-idle: 5 # 连接池中的最小空闲连接
        max-wait: -1 # 连接池最大阻塞等待时间（使用负值表示没有限制）
</code></pre><hr><p><em>update date one year later</em></p><p>命令行更新依赖：<code>mvn dependency:resolve</code>，或使用<code>mvn clean -U</code>。<code>-U</code>参数表示强制更新。<code>Forces a check for missing releases and updated snapshots on remote repositories</code>。</p><p>默认的任务可以使用帮忙函数进行查看，例如 <code>mvn --help</code>查看基础参数；<code>mvn dependency:help</code>查看依赖相关任务；<code>mvn clean:help</code>查看清理函数</p><p><a href=https://docs.spring.io/spring-boot/docs/1.4.1.RELEASE/reference/html/boot-features-external-config.html#boot-features-external-config-application-property-files>指定配置文件</a>，例如——</p><pre tabindex=0><code>java -jar start-1.0.0-SNAPSHOT.jar --spring.config.location=file:/E:/gdoc/serviceMap/application.yml
</code></pre><p><a href=https://www.baeldung.com/spring-boot-run-maven-vs-executable-jar>打包为可执行文件</a>，需要添加mvn插件<code>spring-boot-maven-plugin</code>并指定启动主程序</p><pre tabindex=0><code>&lt;build&gt;
  &lt;plugins&gt;
      &lt;plugin&gt;
          &lt;!--https://www.baeldung.com/spring-boot-run-maven-vs-executable-jar --&gt;
          &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
          &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
          &lt;executions&gt;
              &lt;execution&gt;
                  &lt;configuration&gt;
                      &lt;mainClass&gt;com.gebitang.infra.service.Application&lt;/mainClass&gt;
                  &lt;/configuration&gt;
              &lt;/execution&gt;
          &lt;/executions&gt;
      &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;
</code></pre><ul><li><del>单独使用<code>base-mybatis</code>中的<code>mybatis-plus-boot-starter</code>代替<code>mybatis-spring-boot-starter</code>时，会提示报错类似下面的内容——(初始化数据库Bean对象时)</del></li><li><del>即使不引入<code>base-mybatis</code>，只引入<code>base-swagger</code>时，由于共享了<code>base-dependencies</code>中的依赖声明，还是会默认引入<code>mybatis-plus-boot-starter</code></del></li></ul><p>上述两种情况可能是工程中其他依赖的日志与base相关的依赖产生了冲突。</p><p>导致<code>单一引入</code>的成本过高，只适用于全部都使用。</p><pre tabindex=0><code>Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#39;sqlSessionFactory&#39; defined in class path resource [com/baomidou/mybatisplus/autoconfigure/MybatisPlusAutoConfiguration.class]: Bean instantiation via factory method failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.apache.ibatis.session.SqlSessionFactory]: Factory method &#39;sqlSessionFactory&#39; threw exception; nested exception is java.lang.NoClassDefFoundError: org/mybatis/logging/LoggerFactory
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:658)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:638)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1336)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1179)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:571)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:531)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:335)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:333)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:208)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:276)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1367)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1287)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireByType(AbstractAutowireCapableBeanFactory.java:1503)
	... 75 common frames omitted
Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.apache.ibatis.session.SqlSessionFactory]: Factory method &#39;sqlSessionFactory&#39; threw exception; nested exception is java.lang.NoClassDefFoundError: org/mybatis/logging/LoggerFactory
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:185)
	at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:653)
	... 88 common frames omitted
Caused by: java.lang.NoClassDefFoundError: org/mybatis/logging/LoggerFactory
	at com.baomidou.mybatisplus.extension.spring.MybatisSqlSessionFactoryBean.&lt;clinit&gt;(MybatisSqlSessionFactoryBean.java:94)
	at com.baomidou.mybatisplus.autoconfigure.MybatisPlusAutoConfiguration.sqlSessionFactory(MybatisPlusAutoConfiguration.java:159)
	at com.baomidou.mybatisplus.autoconfigure.MybatisPlusAutoConfiguration$$EnhancerBySpringCGLIB$$f879f3fe.CGLIB$sqlSessionFactory$1(&lt;generated&gt;)
	at com.baomidou.mybatisplus.autoconfigure.MybatisPlusAutoConfiguration$$EnhancerBySpringCGLIB$$f879f3fe$$FastClassBySpringCGLIB$$b09bd244.invoke(&lt;generated&gt;)
	at org.springframework.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:244)
	at org.springframework.context.annotation.ConfigurationClassEnhancer$BeanMethodInterceptor.intercept(ConfigurationClassEnhancer.java:331)
	at com.baomidou.mybatisplus.autoconfigure.MybatisPlusAutoConfiguration$$EnhancerBySpringCGLIB$$f879f3fe.sqlSessionFactory(&lt;generated&gt;)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:154)
	... 89 common frames omitted
Caused by: java.lang.ClassNotFoundException: org.mybatis.logging.LoggerFactory
	at java.net.URLClassLoader.findClass(URLClassLoader.java:381)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:424)
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:349)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
	... 101 common frames omitted
</code></pre><p><a href=https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html>Introduction to the Dependency Mechanism</a>中，<code>import</code>范围只针对<code>&lt;dependencyManagement></code>中依赖定义为<code>pom</code>的类型有效，表示只是提供依赖列表信息，不参与实际的编译过程。</p><pre tabindex=0><code>&lt;dependency&gt;
    &lt;groupId&gt;com.gebitang.base&lt;/groupId&gt;
    &lt;artifactId&gt;base-dependencies&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;scope&gt;import&lt;/scope&gt;
    &lt;type&gt;pom&lt;/type&gt;
&lt;/dependency&gt;
</code></pre><p>依赖机制：A引入B，则B锁需要的所有依赖都自动引入，依赖的依赖也会被自动引入。没有依赖深度限制。</p><p>可能发生循环依赖，或引入了相同包的不同版本，此时，maven引入以下机制——</p><ul><li>最近原则。依赖深度最近的包被使用，依赖深度更深的包被忽略。这样，当有包版本冲突时，直接在pom文件总声明想要的版本就可以被优先使用</li><li>依赖管理。通过在<code>&lt;dependencyManagement></code>中集中声明和管理依赖的版本。匹配了management中的依赖包，优先使用其对应的版本</li><li>依赖范围。默认为<code>compile</code>，其他的包括<code>provided</code>(有JDK提供或启动的容器提供)、<code>runtime</code>(编译期不需要，运行时才使用)、<code>test</code>、<code>system</code>(类似于provide，但需要显示声明所在的路径，例如<code>&lt;systemPath>${java.home}/lib/rt.jar&lt;/systemPath></code>)、<code>import</code></li></ul><div class="prev-next-post pure-g"><div class=pure-u-1-24 style=text-align:left><a href=http://gebitang.com/post/2021/jan-and-feb/><i class="fa fa-chevron-left"></i></a></div><div class=pure-u-10-24><nav class=prev><a href=http://gebitang.com/post/2021/jan-and-feb/>January and February Run</a></nav></div><div class=pure-u-2-24>&nbsp;</div><div class=pure-u-10-24><nav class=next><a href=http://gebitang.com/post/jiansh/bb/%E4%B8%80%E5%8A%A0%E4%B8%80%E5%88%B7%E6%9C%BA%E5%B0%8F%E7%8E%8B%E5%AD%90/>一加一刷机小王子</a></nav></div><div class=pure-u-1-24 style=text-align:right><a href=http://gebitang.com/post/jiansh/bb/%E4%B8%80%E5%8A%A0%E4%B8%80%E5%88%B7%E6%9C%BA%E5%B0%8F%E7%8E%8B%E5%AD%90/><i class="fa fa-chevron-right"></i></a></div></div><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var e=document.createElement("script"),t;e.type="text/javascript",e.async=!0,t="gebitang",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=http://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div><script src=http://gebitang.com/js/ui.js></script>
<script src=http://gebitang.com/js/menus.js></script>
<script>window.location.hostname!="localhost"&&(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-34303694-1","auto"),ga("send","pageview"))</script><button onclick=topFunction() id=myBtn title="Go to top">Top</button></body></html>