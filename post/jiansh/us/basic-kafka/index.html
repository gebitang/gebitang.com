<!doctype html><html xmlns:wb=http://open.weibo.com/wb lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content>
<meta name=generator content="Hugo 0.91.2">
<title>Basic-Kafka &#183; 戈壁堂</title>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css><!--[if lte IE 8]><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css><![endif]--><!--[if gt IE 8]><!-->
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css><!--<![endif]--><!--[if lte IE 8]><link rel=stylesheet href=http://gebitang.com/css/side-menu-old-ie.css><![endif]--><!--[if gt IE 8]><!-->
<link rel=stylesheet href=http://gebitang.com/css/side-menu.css><!--<![endif]-->
<link rel=stylesheet href=http://gebitang.com/css/blackburn.css>
<link rel=stylesheet href=https://use.fontawesome.com/releases/v5.9.0/css/all.css>
<link href="https://fonts.googleapis.com/css?family=Raleway" rel=stylesheet type=text/css>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js></script>
<script>hljs.initHighlightingOnLoad()</script>
<link rel="shortcut icon" href=http://gebitang.com/img/favicon.ico type=image/x-icon>
<link rel=stylesheet href=http://gebitang.com/css/my.css>
<script src=http://gebitang.com/js/my.js></script>
</head>
<body>
<div id=layout>
<a href=#menu id=menuLink class=menu-link>
<span></span>
</a>
<div id=menu>
<a class="pure-menu-heading brand" href=http://gebitang.com/>Gebitang</a>
<div class=pure-menu>
<ul class=pure-menu-list>
<li class=pure-menu-item>
<a class=pure-menu-link href=http://gebitang.com/><i class="fa fa-home fa-fw"></i>Home</a>
</li>
<li class=pure-menu-item>
<a class=pure-menu-link href=http://gebitang.com/post/><i class="fa fa-list fa-fw"></i>Posts</a>
</li>
<li class=pure-menu-item>
<a class=pure-menu-link href=http://gebitang.com/about/><i class="fa fa-user fa-fw"></i>About</a>
</li>
<li class=pure-menu-item>
<a class=pure-menu-link href=http://gebitang.com/contact/><i class="fa fa-phone fa-fw"></i>Contact</a>
</li>
<li class=pure-menu-item>
<a class=pure-menu-link href=http://gebitang.com/tags/><i class="fa fa-tags fa-fw"></i>Tags</a>
</li>
<li class=pure-menu-item>
<a class=pure-menu-link href=http://gebitang.com/topics/><i class="fa fa-folder fa-fw"></i>Topics</a>
</li>
</ul>
</div>
<div class="pure-menu social">
<ul class=pure-menu-list>
</ul>
</div>
<div>
<div class=small-print>
<small>
<a rel=license href=http://creativecommons.org/licenses/by/4.0/><img alt=知识共享许可协议 style=border-width:0 src=https://i.creativecommons.org/l/by/4.0/80x15.png></a><br>本<span xmlns:dct=http://purl.org/dc/terms/ href=http://purl.org/dc/dcmitype/Text rel=dct:type>作品</span>由<a xmlns:cc=http://creativecommons.org/ns# href=http://gebitang.com property="cc:attributionName" rel=cc:attributionurl>&nbsp;Gebitang&nbsp;&nbsp;</a>采用<a rel=license href=http://creativecommons.org/licenses/by/4.0/>知识共享署名 4.0 国际许可协议</a>进行许可&nbsp;&copy; 2018
</small>
</div>
<div class=small-print>
<small></small>
</div>
<div class=small-print>
<small>Built with&nbsp;<a href=https://gohugo.io/ target=_blank>Hugo</a></small>
<small>Theme&nbsp;<a href=https://github.com/yoshiharuyamashita/blackburn target=_blank>Blackburn</a></small>
</div>
<div style=display:none>
<div class=small-print>
<small>
<wb:follow-button uid=2446212465 type=red_1 width=67 height=24></wb:follow-button>
</small>
</div>
</div>
</div>
</div>
<div id=main>
<div class=header>
<h1>Basic-Kafka</h1>
<h2></h2>
</div>
<div class=content>
<div class=post-meta>
<div>
<i class="fa fa-calendar fa-fw"></i>
<time>2020-03-07</time>
</div>
<div>
<i class="fa fa-folder fa-fw"></i>
<a class=post-taxonomy-topic href=http://gebitang.com/topics/jiansh>jiansh</a>&nbsp;/
<a class=post-taxonomy-topic href=http://gebitang.com/topics/us>US</a>
</div>
<div>
<i class="fa fa-tags fa-fw"></i>
<a class=post-taxonomy-tag href=http://gebitang.com/tags/jiansh>jiansh</a>
</div>
</div>
<nav id=TableOfContents>
<ul>
<li>
<ul>
<li><a href=#启动server时会提示javalangnumberformatexception-for-input-string-initialrebalancedelayms错误根据这里httpsstackoverflowcoma575133231087122的提示在window环境下执行binwindowskafka-server-startbat-configserverproperties>启动Server时，会提示<code>java.lang.NumberFormatException: For input string: "initial.rebalance.delay.ms"</code>错误，根据<a href=https://stackoverflow.com/a/57513323/1087122>这里</a>的提示，在window环境下执行：<code>.\bin\windows\kafka-server-start.bat .\config\server.properties</code></a></li>
<li><a href=#提示找不到或无法加载主类-orgapachezookeeperserverquorumquorumpeermain>提示<code>找不到或无法加载主类 org.apache.zookeeper.server.quorum.quorumpeermain</code></a></li>
<li><a href=#提示无法创建数据文件>提示`无法创建数据文件</a></li>
</ul>
</li>
</ul>
</nav>
<p><a href=https://www.jianshu.com/p/fbaaa7fe7f62>link on JianShu</a></p>
<p><a href=https://kafka.apache.org/quickstart>https://kafka.apache.org/quickstart</a></p>
<ul>
<li>Java8 + Windows环境</li>
<li>Zookeeper环境</li>
</ul>
<h3 id=启动server时会提示javalangnumberformatexception-for-input-string-initialrebalancedelayms错误根据这里httpsstackoverflowcoma575133231087122的提示在window环境下执行binwindowskafka-server-startbat-configserverproperties>启动Server时，会提示<code>java.lang.NumberFormatException: For input string: "initial.rebalance.delay.ms"</code>错误，根据<a href=https://stackoverflow.com/a/57513323/1087122>这里</a>的提示，在window环境下执行：<code>.\bin\windows\kafka-server-start.bat .\config\server.properties</code></h3>
<p>可以正常启动——这里启动的还是kafka的server，用来连接zookeeper的server，需要先启动zk。否则会超时自动结束。</p>
<pre tabindex=0><code>PS D:\tools\kafka_2.12-2.3.0&gt; .\bin\windows\kafka-server-start.bat .\config\server.properties

[2019-11-19 11:24:32,075] INFO Registered kafka:type=kafka.Log4jController MBean (kafka.utils.Log4jControllerRegistration$)
[2019-11-19 11:24:32,429] INFO starting (kafka.server.KafkaServer)
[2019-11-19 11:24:32,430] INFO Connecting to zookeeper on localhost:2181 (kafka.server.KafkaServer)
[2019-11-19 11:24:32,446] INFO [ZooKeeperClient Kafka server] Initializing a new session to localhost:2181. (kafka.zookeeper.ZooKeeperClient) [2019-11-19 11:24:32,453] INFO Client environment:zookeeper.version=3.4.14-4c25d480e66aadd371de8bd2fd8da255ac140bcf, built on 03/06/2019 16:18 GMT (org.apache.zookeeper.ZooKeeper)
[2019-11-19 11:24:32,453] INFO Client environment:host.name=Gebitang (org.apache.zookeeper.ZooKeeper)
...
[2019-11-19 11:24:40,813] ERROR Fatal error during KafkaServer startup. Prepare to shutdown (kafka.server.KafkaServer)
kafka.zookeeper.ZooKeeperClientTimeoutException: Timed out waiting for connection while in state: CONNECTING
        at kafka.zookeeper.ZooKeeperClient.$anonfun$waitUntilConnected$3(ZooKeeperClient.scala:258)
        at scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.java:23)
        at kafka.utils.CoreUtils$.inLock(CoreUtils.scala:253)
        at kafka.zookeeper.ZooKeeperClient.waitUntilConnected(ZooKeeperClient.scala:254)
        at kafka.zookeeper.ZooKeeperClient.&lt;init&gt;(ZooKeeperClient.scala:112)
        at kafka.zk.KafkaZkClient$.apply(KafkaZkClient.scala:1826)
        at kafka.server.KafkaServer.createZkClient$1(KafkaServer.scala:364)
        at kafka.server.KafkaServer.initZkClient(KafkaServer.scala:387)
        at kafka.server.KafkaServer.startup(KafkaServer.scala:207)
        at kafka.server.KafkaServerStartable.startup(KafkaServerStartable.scala:38)
        at kafka.Kafka$.main(Kafka.scala:84)
        at kafka.Kafka.main(Kafka.scala)
[2019-11-19 11:24:40,818] INFO shutting down (kafka.server.KafkaServer)
[2019-11-19 11:24:40,822] INFO shut down completed (kafka.server.KafkaServer)
[2019-11-19 11:24:40,823] ERROR Exiting Kafka. (kafka.server.KafkaServerStartable)
[2019-11-19 11:24:40,825] INFO shutting down (kafka.server.KafkaServer)
</code></pre><p><a href=https://dzone.com/articles/running-apache-kafka-on-windows-os>Windows环境搭建参考</a> 有错误部分，以下文为准。</p>
<p><a href=https://zookeeper.apache.org/>https://zookeeper.apache.org/</a> &ndash;><a href=https://zookeeper.apache.org/doc/current/index.html>https://zookeeper.apache.org/doc/current/index.html</a>
&ndash;><a href=https://zookeeper.apache.org/doc/current/zookeeperStarted.html>https://zookeeper.apache.org/doc/current/zookeeperStarted.html</a></p>
<h3 id=提示找不到或无法加载主类-orgapachezookeeperserverquorumquorumpeermain>提示<code>找不到或无法加载主类 org.apache.zookeeper.server.quorum.quorumpeermain</code></h3>
<p>使用下载的bin压缩包，例如<code>apache-zookeeper-3.5.6-bin.tar.gz </code>而不是 <code>apache-zookeeper-3.5.6.tar.gz </code>，后者是源码，非编译后的bin包。</p>
<h3 id=提示无法创建数据文件>提示`无法创建数据文件</h3>
<p>修改的conf文件里的目录地址使用<code>/</code>分割，不要使用window默认的<code>\</code>格式，后者导致路径错误，作为转移符号处理了</p>
<pre tabindex=0><code>2019-11-19 12:00:44,800 [myid:] - ERROR [main:ZooKeeperServerMain@75] - Unable to access datadir, exiting abnormally
org.apache.zookeeper.server.persistence.FileTxnSnapLog$DatadirException: Unable to create data directory D:     oolsapache-zookeeper-3.5.6data\version-2
        at org.apache.zookeeper.server.persistence.FileTxnSnapLog.&lt;init&gt;(FileTxnSnapLog.java:115)
        at org.apache.zookeeper.server.ZooKeeperServerMain.runFromConfig(ZooKeeperServerMain.java:124)
        at org.apache.zookeeper.server.ZooKeeperServerMain.initializeAndRun(ZooKeeperServerMain.java:106)
        at org.apache.zookeeper.server.ZooKeeperServerMain.main(ZooKeeperServerMain.java:64)
        at org.apache.zookeeper.server.quorum.QuorumPeerMain.initializeAndRun(QuorumPeerMain.java:128)
        at org.apache.zookeeper.server.quorum.QuorumPeerMain.main(QuorumPeerMain.java:82)
Unable to access datadir, exiting abnormally
</code></pre><hr>
<p>这样，环境搭建算OK了。</p>
<ol>
<li>创建topic <code>.\kafka-topics.bat --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test</code></li>
</ol>
<pre tabindex=0><code>PS D:\tools\kafka_2.12-2.3.0\bin\windows&gt; .\kafka-topics.bat --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test
Created topic test.
PS D:\tools\kafka_2.12-2.3.0\bin\windows&gt; .\kafka-topics.bat --list --zookeeper localhost:2181
test
</code></pre><ol start=2>
<li>创建producer和consumer发送消息</li>
</ol>
<pre tabindex=0><code># producer
 .\kafka-console-producer.bat --broker-list localhost:9092 --topic test

# consumer
.\kafka-console-consumer.bat --bootstrap-server localhost:9092 --topic test --from-beginning
</code></pre><p>###[总结]</p>
<p><a href=https://zookeeper.apache.org/doc/current/zookeeperStarted.html>安装zookeeper：</a></p>
<ul>
<li>下载bin压缩包，配置环境变量</li>
<li>修改config文件 <code>zoo.cfg</code></li>
<li>启动server <code>zkserver</code></li>
</ul>
<p>使用kafka</p>
<ol>
<li>启动zkserver <code>zkserver</code> （独立安装zookeeper之后）</li>
<li>启动kafka broker <code>.\bin\windows\kafka-server-start.bat .\config\server.properties</code></li>
<li>启动producer和consumer</li>
</ol>
<div class="prev-next-post pure-g">
<div class=pure-u-1-24 style=text-align:left>
<a href=http://gebitang.com/post/jiansh/us/basic-kibana/><i class="fa fa-chevron-left"></i></a>
</div>
<div class=pure-u-10-24>
<nav class=prev>
<a href=http://gebitang.com/post/jiansh/us/basic-kibana/>Basic-Kibana</a>
</nav>
</div>
<div class=pure-u-2-24>
&nbsp;
</div>
<div class=pure-u-10-24>
<nav class=next>
<a href=http://gebitang.com/post/jiansh/us/basic-javaagent/>Basic-Javaagent</a>
</nav>
</div>
<div class=pure-u-1-24 style=text-align:right>
<a href=http://gebitang.com/post/jiansh/us/basic-javaagent/><i class="fa fa-chevron-right"></i></a>
</div>
</div>
<div id=disqus_thread></div>
<script type=text/javascript>(function(){var a,b;if(window.location.hostname=="localhost")return;a=document.createElement('script'),a.type='text/javascript',a.async=!0,b='gebitang',a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=http://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
</div>
</div>
<script src=http://gebitang.com/js/ui.js></script>
<script src=http://gebitang.com/js/menus.js></script>
<script>window.location.hostname!="localhost"&&(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','//www.google-analytics.com/analytics.js','ga'),ga('create','UA-34303694-1','auto'),ga('send','pageview'))</script>
<button onclick=topFunction() id=myBtn title="Go to top">Top</button>
</body>
</html>